<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Long Short-Term Memory (LSTM) - ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="Long Short-Term Memory (LSTM)" />
<meta property="og:description" content="ê°ì„± ë¶„ì„(Sentiment Analysis)ì„ ìœ„í•´ì„œ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ë°©ë²•ê³¼ LSTMì— ëŒ€í•´ ì•Œì•„ë³´ê³  kerasë¥¼ ì´ìš©í•´ì„œ ëª¨ë¸ë§ì„ í•´ë³´ì!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/long_short_term_memory/" />
<meta property="article:published_time" content="2019-09-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-14T00:00:00+00:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ" rel="home">
				<div class="logo__title">ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ</div>
				<div class="logo__tagline">ë”¥ëŸ¬ë‹ ëª¨ë¸ë§</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Long Short-Term Memory (LSTM)</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-09-14T00:00:00">2019-09-14</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/deep-learning" rel="category">Deep Learning</a>, <a class="meta__link" href="/categories/recurrent-neural-network" rel="category">Recurrent Neural Network</a></span>
</div>
</div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#ë¬¸ì œ-problem">ë¬¸ì œ (Problem)</a></li>
<li><a href="#ë°ì´í„°-ìˆ˜ì§‘-data-collection">ë°ì´í„° ìˆ˜ì§‘ (Data Collection)</a>
<ul>
<li><a href="#rating-ë°ì´í„°-í”„ë ˆì„">Rating ë°ì´í„° í”„ë ˆì„</a></li>
</ul></li>
<li><a href="#ë°ì´í„°-ë¶„ì„-data-analysis">ë°ì´í„° ë¶„ì„ (Data Analysis)</a></li>
<li><a href="#ë°ì´í„°-ì „ì²˜ë¦¬-data-preprocessing">ë°ì´í„° ì „ì²˜ë¦¬ (Data Preprocessing)</a>
<ul>
<li><a href="#í˜•íƒœì†Œ-ë¶„ì„ê¸°-ì„¤ì¹˜">í˜•íƒœì†Œ ë¶„ì„ê¸° ì„¤ì¹˜</a></li>
<li><a href="#í† í°í™”-tokenization">í† í°í™” (Tokenization)</a>
<ul>
<li><a href="#í’ˆì‚¬-part-of-speech">í’ˆì‚¬ (Part Of Speech)</a></li>
<li><a href="#ë¶ˆìš©ì–´-stop-words">ë¶ˆìš©ì–´ (Stop Words)</a></li>
<li><a href="#ì–´ê°„-ì›í˜•-ë³µì›-lemmatization">ì–´ê°„ ì›í˜• ë³µì› (Lemmatization)</a></li>
</ul></li>
</ul></li>
<li><a href="#lstm-ëª¨ë¸ë§-lstm-modeling">LSTM ëª¨ë¸ë§ (LSTM Modeling)</a>
<ul>
<li><a href="#lstm-long-short-term-memory">LSTM (Long Short-Term Memory)</a></li>
<li><a href="#many-to-one-model">Many-to-One Model</a></li>
<li><a href="#ì •ë¦¬">ì •ë¦¬</a></li>
</ul></li>
<li><a href="#ì¼€ë¼ìŠ¤-keras-ë¡œ-ëª¨ë¸ë§-modeling">ì¼€ë¼ìŠ¤(Keras)ë¡œ ëª¨ë¸ë§(Modeling)</a>
<ul>
<li><a href="#ë°ì´í„°-ë³€í™˜-data-transformation">ë°ì´í„° ë³€í™˜ (Data Transformation)</a>
<ul>
<li><a href="#encoding">Encoding</a></li>
<li><a href="#padding">Padding</a></li>
<li><a href="#ì´ì§„-ë¶„ë¥˜-binary-classification">ì´ì§„ ë¶„ë¥˜ (Binary classification)</a></li>
</ul></li>
<li><a href="#ëª¨ë¸ë§-modeling">ëª¨ë¸ë§ (Modeling)</a></li>
<li><a href="#ëª¨ë¸-í›ˆë ¨-train-model">ëª¨ë¸ í›ˆë ¨ (Train Model)</a></li>
<li><a href="#ëª¨ë¸-í…ŒìŠ¤íŠ¸-test-model">ëª¨ë¸ í…ŒìŠ¤íŠ¸ (Test Model)</a></li>
<li><a href="#ëª¨ë¸-ì €ì¥-save-model">ëª¨ë¸ ì €ì¥ (Save Model)</a></li>
</ul></li>
<li><a href="#í•´ê²°-solution">í•´ê²° (Solution)</a></li>
</ul></li>
</ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<p>ê°ì„± ë¶„ì„(Sentiment Analysis)ì„ ìœ„í•´ì„œ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ëŠ” ë°©ë²•ê³¼ LSTMì— ëŒ€í•´ ì•Œì•„ë³´ê³  kerasë¥¼ ì´ìš©í•´ì„œ ëª¨ë¸ë§ì„ í•´ë³´ì!</p>

<p>ì‹¤ì œë¡œ ëŒë ¤ ë³´ê³  ì‹¶ìœ¼ë©´ êµ¬ê¸€ ì½”ë©ìœ¼ë¡œ ~</p>

<p><a href="https://colab.research.google.com/github/skettee/notebooks/blob/master/long_short_term_memory.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>

<h2 id="ë¬¸ì œ-problem">ë¬¸ì œ (Problem)</h2>

<p>ğŸ‘¤ ìƒì‚¬</p>

<blockquote>
<p>ì˜¤~ ê°„ë‹¨í•œ ê°ì„± ë¶„ì„ê¸°ë¥¼ ë§Œë“¤ì—ˆêµ°<br />
ê·¼ë° ì´ê±´ ì• ë“¤ ì¥ë‚œì´ê³ &hellip;<br />
ë„¤ì´ë²„ê°€ ì œê³µí•˜ëŠ” ì˜í™” ë¦¬ë·° ë°ì´í„°ë¡œ<br />
ì œëŒ€ë¡œ ëœ ê°ì„± ë¶„ì„ê¸°ë¥¼ ë§Œë“¤ì–´ ë³´ê²Œ<br />
ë°ì´í„°ëŠ” ì•„ë˜ì— ìˆë„¤</p>

<p><a href="https://github.com/e9t/nsmc">https://github.com/e9t/nsmc</a></p>
</blockquote>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>í”„ë¡œì íŠ¸ê°€ ìŒ“ì—¬ë§Œ ê°„ë‹¤&hellip;<br />
ì´ì œ<br />
ë– ë‚  ë•Œê°€ ëœê²ƒì¸ê°€&hellip;</p>
</blockquote>

<h2 id="ë°ì´í„°-ìˆ˜ì§‘-data-collection">ë°ì´í„° ìˆ˜ì§‘ (Data Collection)</h2>

<p><a href="https://github.com/e9t/nsmc">https://github.com/e9t/nsmc</a> ì—ì„œ ë°ì´í„° ì •ë³´ë¥¼ ì•Œì•„ë³´ì</p>

<p><strong>Data description</strong>
- Each file is consisted of three columns: id, document, label
    - id: The review id, provieded by Naver
    - document: The actual review
    - label: The sentiment class of the review. (0: negative, 1: positive)
    - Columns are delimited with tabs (i.e., .tsv format; but the file extension is .txt for easy access for novices)
- 200K reviews in total
    - ratings.txt: All 200K reviews
    - ratings_test.txt: 50K reviews held out for testing
    - ratings_train.txt: 150K reviews for training</p>

<p><strong>Characteristics</strong>
- All reviews are shorter than 140 characters
- Each sentiment class is sampled equally (i.e., random guess yields 50% accuracy)
    - 100K negative reviews (originally reviews of ratings 1-4)
    -100K positive reviews (originally reviews of ratings 9-10)
    - Neutral reviews (originally reviews of ratings 5-8) are excluded</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ratings_test.txt, ratings_train.txtë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ì</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.keras.utils <span style="color:#f92672">import</span> get_file

train_fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ratings_train.tsv&#39;</span>
test_fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ratings_test.tsv&#39;</span>
train_origin <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://raw.github.com/e9t/nsmc/master/ratings_train.txt&#39;</span>
test_origin <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://raw.github.com/e9t/nsmc/master/ratings_test.txt&#39;</span>

train_path <span style="color:#f92672">=</span> get_file(train_fname, train_origin)
test_path <span style="color:#f92672">=</span> get_file(test_fname, test_origin)</code></pre></div>
<h3 id="rating-ë°ì´í„°-í”„ë ˆì„">Rating ë°ì´í„° í”„ë ˆì„</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

train_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(train_path, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>) <span style="color:#75715e"># tsv file</span>
train_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>document</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>9976970</td>
      <td>ì•„ ë”ë¹™.. ì§„ì§œ ì§œì¦ë‚˜ë„¤ìš” ëª©ì†Œë¦¬</td>
      <td>0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>3819312</td>
      <td>í ...í¬ìŠ¤í„°ë³´ê³  ì´ˆë”©ì˜í™”ì¤„....ì˜¤ë²„ì—°ê¸°ì¡°ì°¨ ê°€ë³ì§€ ì•Šêµ¬ë‚˜</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>10265843</td>
      <td>ë„ˆë¬´ì¬ë°“ì—ˆë‹¤ê·¸ë˜ì„œë³´ëŠ”ê²ƒì„ì¶”ì²œí•œë‹¤</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>9045019</td>
      <td>êµë„ì†Œ ì´ì•¼ê¸°êµ¬ë¨¼ ..ì†”ì§íˆ ì¬ë¯¸ëŠ” ì—†ë‹¤..í‰ì  ì¡°ì •</td>
      <td>0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>6483659</td>
      <td>ì‚¬ì´ëª¬í˜ê·¸ì˜ ìµì‚´ìŠ¤ëŸ° ì—°ê¸°ê°€ ë‹ë³´ì˜€ë˜ ì˜í™”!ìŠ¤íŒŒì´ë”ë§¨ì—ì„œ ëŠ™ì–´ë³´ì´ê¸°ë§Œ í–ˆë˜ ì»¤ìŠ¤í‹´ ...</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">test_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(test_path, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>) <span style="color:#75715e"># tsv file</span>
test_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>document</th>
      <th>label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>6270596</td>
      <td>êµ³ ã…‹</td>
      <td>1</td>
    </tr>
    <tr>
      <td>1</td>
      <td>9274899</td>
      <td>GDNTOPCLASSINTHECLUB</td>
      <td>0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>8544678</td>
      <td>ë­ì•¼ ì´ í‰ì ë“¤ì€.... ë‚˜ì˜ì§„ ì•Šì§€ë§Œ 10ì  ì§œë¦¬ëŠ” ë”ë”ìš± ì•„ë‹ˆì–ì•„</td>
      <td>0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>6825595</td>
      <td>ì§€ë£¨í•˜ì§€ëŠ” ì•Šì€ë° ì™„ì „ ë§‰ì¥ì„... ëˆì£¼ê³  ë³´ê¸°ì—ëŠ”....</td>
      <td>0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>6723715</td>
      <td>3Dë§Œ ì•„ë‹ˆì—ˆì–´ë„ ë³„ ë‹¤ì„¯ ê°œ ì¤¬ì„í…ë°.. ì™œ 3Dë¡œ ë‚˜ì™€ì„œ ì œ ì‹¬ê¸°ë¥¼ ë¶ˆí¸í•˜ê²Œ í•˜ì£ ??</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="ë°ì´í„°-ë¶„ì„-data-analysis">ë°ì´í„° ë¶„ì„ (Data Analysis)</h2>

<p>ë¹µê¾¸ë‚œê±° ë¶€í„° í™•ì¸í•˜ê³  ì œê±°í•˜ì</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_df<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>any()</code></pre></div>
<pre><code>id          False
document     True
label       False
dtype: bool
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_df <span style="color:#f92672">=</span> train_df<span style="color:#f92672">.</span>dropna(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span>True)</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">test_df<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>any()</code></pre></div>
<pre><code>id          False
document     True
label       False
dtype: bool
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">test_df <span style="color:#f92672">=</span> test_df<span style="color:#f92672">.</span>dropna(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span>True)</code></pre></div>
<p>ë°ì´í„°ì˜ í¬ê¸°ì™€ ë ˆì´ë¸”ì— ë”°ë¥¸ ë¶„í¬ë¥¼ í™•ì¸í•˜ì</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Train data shape: &#39;</span>, train_df<span style="color:#f92672">.</span>shape)
n_lebel <span style="color:#f92672">=</span> len(train_df[train_df<span style="color:#f92672">.</span>label <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Label 0 in Train data: {} ({:.1f}%)&#39;</span><span style="color:#f92672">.</span>format(n_lebel, n_lebel<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#f92672">/</span>len(train_df)))
n_lebel <span style="color:#f92672">=</span> len(train_df[train_df<span style="color:#f92672">.</span>label <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Label 1 in Train data: {} ({:.1f}%)&#39;</span><span style="color:#f92672">.</span>format(n_lebel, n_lebel<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#f92672">/</span>len(train_df)))

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Test data shape: &#39;</span>, test_df<span style="color:#f92672">.</span>shape)
n_lebel <span style="color:#f92672">=</span> len(test_df[test_df<span style="color:#f92672">.</span>label <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Label 0 in Test data: {} ({:.1f}%)&#39;</span><span style="color:#f92672">.</span>format(n_lebel, n_lebel<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#f92672">/</span>len(test_df)))
n_lebel <span style="color:#f92672">=</span> len(test_df[test_df<span style="color:#f92672">.</span>label <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Label 1 in Test data: {} ({:.1f}%)&#39;</span><span style="color:#f92672">.</span>format(n_lebel, n_lebel<span style="color:#f92672">*</span><span style="color:#ae81ff">100</span><span style="color:#f92672">/</span>len(test_df)))</code></pre></div>
<pre><code>Train data shape:  (149995, 3)
Label 0 in Train data: 75170 (50.1%)
Label 1 in Train data: 74825 (49.9%)

Test data shape:  (49997, 3)
Label 0 in Test data: 24826 (49.7%)
Label 1 in Test data: 25171 (50.3%)
</code></pre>

<p><code>id</code>ì»¬ëŸ¼ì€ í•„ìš” ì—†ìœ¼ë‹ˆ ì œê±°í•˜ì.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_df <span style="color:#f92672">=</span> train_df[[<span style="color:#e6db74">&#39;document&#39;</span>, <span style="color:#e6db74">&#39;label&#39;</span>]]
test_df <span style="color:#f92672">=</span> test_df[[<span style="color:#e6db74">&#39;document&#39;</span>, <span style="color:#e6db74">&#39;label&#39;</span>]]</code></pre></div>
<h2 id="ë°ì´í„°-ì „ì²˜ë¦¬-data-preprocessing">ë°ì´í„° ì „ì²˜ë¦¬ (Data Preprocessing)</h2>

<p>í•œê¸€ í…ìŠ¤íŠ¸ë¥¼ RNNì— ì…ë ¥í•˜ê¸° ìœ„í•´ì„œëŠ” í…ìŠ¤íŠ¸ë¥¼ RNNì´ ì²˜ë¦¬í•˜ê¸° í¸í•œ í˜•íƒœë¡œ ë¶„ë¦¬í•´ì•¼ í•œë‹¤. ì´ë ‡ê²Œ í…ìŠ¤íŠ¸ë¥¼ ë¶„ë¦¬í•˜ëŠ” ì‘ì—…ì„ <strong>í† ê·¼í™”(Tokenization)</strong> ë¼ê³  í•œë‹¤.<br />
í•œê¸€ì„ í† í°í™” í•˜ê¸° ìœ„í•´ì„œ í˜•íƒœì†Œ ë¶„ì„ê¸°ë¥¼ ì‚¬ìš©í•œë‹¤. ë‹¤ì–‘í•œ í•œê¸€ í˜•íƒœì†Œ ë¶„ì„ê¸°ê°€ ì¡´ì¬í•˜ëŠ”ë°, ì—¬ê¸°ì—ì„œëŠ” PyKomoranì„ ì‚¬ìš©í•œë‹¤. ë‹¤ë¥¸ í˜•íƒœì†Œ ë¶„ì„ê¸°ì— ê´€ì‹¬ì´ ìˆìœ¼ë©´ ì•„ë˜ë¥¼ ì°¸ì¡°í•œë‹¤.</p>

<ul>
<li><a href="https://bitbucket.org/eunjeon/mecab-ko-dic/src/master/">Mecap</a></li>
<li><a href="https://github.com/kakao/khaiii">Khaiii</a></li>
<li><a href="https://github.com/shin285/KOMORAN">Komoran</a></li>
</ul>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì•ì—ì„œ ë³¸ ì´ëª¨í‹°ì½˜ ê°ì„±ë¶„ì„ì—ì„œ<br />
ì´ëª¨í‹°ì½˜ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í–ˆëŠ”ë°<br />
ë°˜ëŒ€ë¡œ<br />
í…ìŠ¤íŠ¸ë¥¼ ì´ëª¨í‹°ì½˜ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì„<br />
í† í°í™”(Tokenization)ë¼ê³  ìƒê°í•˜ë©´<br />
ì´í•´ê°€ ì‰¬ìš¸ ê²ƒ ê°™ë‹¤&hellip;</p>
</blockquote>

<h3 id="í˜•íƒœì†Œ-ë¶„ì„ê¸°-ì„¤ì¹˜">í˜•íƒœì†Œ ë¶„ì„ê¸° ì„¤ì¹˜</h3>

<p>PyKomoranì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” Javaê°€ ì„¤ì¹˜ ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤. ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì„œ Javaê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">!</span>java <span style="color:#f92672">-</span>version</code></pre></div>
<pre><code>openjdk version &quot;1.8.0_152-release&quot;
OpenJDK Runtime Environment (build 1.8.0_152-release-1056-b12)
OpenJDK 64-Bit Server VM (build 25.152-b12, mixed mode)
</code></pre>

<p>PyKomoranì„ ì„¤ì¹˜í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">%</span>pip install PyKomoran</code></pre></div>
<pre><code>Collecting PyKomoran
[?25l  Downloading https://files.pythonhosted.org/packages/23/b0/ce6a46f311651ed64c39beb1cfe1c39a9906521139ace45430d08c489b62/PyKomoran-0.1.5-py3-none-any.whl (7.9MB)
[K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7.9MB 1.2MB/s eta 0:00:01
[?25hCollecting py4j==0.10.8.1 (from PyKomoran)
[?25l  Downloading https://files.pythonhosted.org/packages/04/de/2d314a921ef4c20b283e1de94e0780273678caac901564df06b948e4ba9b/py4j-0.10.8.1-py2.py3-none-any.whl (196kB)
[K     |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 204kB 2.1MB/s eta 0:00:01
[?25hInstalling collected packages: py4j, PyKomoran
Successfully installed PyKomoran-0.1.5 py4j-0.10.8.1
Note: you may need to restart the kernel to use updated packages.
</code></pre>

<p>ì„¤ì¹˜ í™•ì¸ì„ ìœ„í•´ ì•„ë˜ ì½”ë“œë¥¼ ì‹¤í–‰í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> PyKomoran <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

corpus <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;â‘  ëŒ€í•œë¯¼êµ­ì€ ë¯¼ì£¼ê³µí™”êµ­ì´ë‹¤.&#34;</span>
komoran <span style="color:#f92672">=</span> Komoran(<span style="color:#e6db74">&#34;STABLE&#34;</span>)
komoran<span style="color:#f92672">.</span>get_plain_text(corpus)</code></pre></div>
<pre><code>'â‘ /SW ëŒ€í•œë¯¼êµ­/NNP ì€/JX ë¯¼ì£¼/NNP ê³µí™”êµ­/NNG ì´/VCP ë‹¤/EF ./SF'
</code></pre>

<h3 id="í† í°í™”-tokenization">í† í°í™” (Tokenization)</h3>

<p>í˜•íƒœì†Œ ë¶„ì„ê¸°ëŠ” ë¬¸ì¥ì„ í’ˆì‚¬(PoS)ë³„ë¡œ ë¶„ë¦¬í•´ ì¤€ë‹¤. ëª¨ë“  í’ˆì‚¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°ì„± ë¶„ì„ì— í•„ìš”í•˜ë‹¤ê³  íŒë‹¨ì´ ë˜ëŠ” í’ˆì‚¬ë¥¼ ì„ ì •í•´ì„œ í† í°í™”ë¥¼ ì§„í–‰í•œë‹¤.</p>

<h4 id="í’ˆì‚¬-part-of-speech">í’ˆì‚¬ (Part Of Speech)</h4>

<p>Komoranì—ì„œ ì •ì˜í•˜ëŠ” í’ˆì‚¬ ì¢…ë¥˜ëŠ” ì•„ë˜ ì‚¬ì´íŠ¸ë¥¼ ì°¸ì¡°.<br />
í’ˆì‚¬í‘œ (PoS Table): <a href="https://pydocs.komoran.kr/firststep/postypes.html">https://pydocs.komoran.kr/firststep/postypes.html</a></p>

<h4 id="ë¶ˆìš©ì–´-stop-words">ë¶ˆìš©ì–´ (Stop Words)</h4>

<p>RNNì— ì…ë ¥ìœ¼ë¡œ ë“¤ì–´ê°€ì§€ ëª»í•˜ëŠ” ë‹¨ì–´ë“¤ì„ ë§í•œë‹¤. ì—¬ê¸°ì„œëŠ” ë“¤ì–´ê°€ì§€ ëª»í•˜ëŠ” í’ˆì‚¬ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì •ì˜í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">stop_pos_tags <span style="color:#f92672">=</span>  [<span style="color:#e6db74">&#39;IC&#39;</span>, <span style="color:#e6db74">&#39;JKS&#39;</span>, <span style="color:#e6db74">&#39;JKC&#39;</span>, <span style="color:#e6db74">&#39;JKG&#39;</span>, <span style="color:#e6db74">&#39;JKO&#39;</span>, <span style="color:#e6db74">&#39;JKB&#39;</span>, <span style="color:#e6db74">&#39;JKV&#39;</span>, <span style="color:#e6db74">&#39;JKQ&#39;</span>, <span style="color:#e6db74">&#39;JX&#39;</span>, 
                   <span style="color:#e6db74">&#39;EF&#39;</span>, <span style="color:#e6db74">&#39;ETN&#39;</span>, <span style="color:#e6db74">&#39;ETM&#39;</span>, <span style="color:#e6db74">&#39;XSA&#39;</span>, <span style="color:#e6db74">&#39;SF&#39;</span>, <span style="color:#e6db74">&#39;SP&#39;</span>, <span style="color:#e6db74">&#39;SS&#39;</span>, <span style="color:#e6db74">&#39;SE&#39;</span>, <span style="color:#e6db74">&#39;SO&#39;</span>, <span style="color:#e6db74">&#39;SL&#39;</span>, <span style="color:#e6db74">&#39;SH&#39;</span>, 
                   <span style="color:#e6db74">&#39;SW&#39;</span>, <span style="color:#e6db74">&#39;NF&#39;</span>, <span style="color:#e6db74">&#39;NV&#39;</span>, <span style="color:#e6db74">&#39;SN&#39;</span>, <span style="color:#e6db74">&#39;NA&#39;</span>]</code></pre></div>
<h4 id="ì–´ê°„-ì›í˜•-ë³µì›-lemmatization">ì–´ê°„ ì›í˜• ë³µì› (Lemmatization)</h4>

<p>ë™ì‚¬ì™€ í˜•ìš©ì‚¬ì˜ ê²½ìš°ì—ëŠ” ì–´ê°„(Stem)ì— &lsquo;ë‹¤&rsquo;ë¥¼ ë¶™ì—¬ì„œ ê¸°ë³¸í˜•ìœ¼ë¡œ ë³µì›í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize</span>(corpus, stop_pos_tags):
    result <span style="color:#f92672">=</span> []
    pairs <span style="color:#f92672">=</span> komoran<span style="color:#f92672">.</span>get_list(corpus)
    <span style="color:#66d9ef">for</span> pair <span style="color:#f92672">in</span> pairs:
        morph <span style="color:#f92672">=</span> pair<span style="color:#f92672">.</span>get_first()
        pos <span style="color:#f92672">=</span> pair<span style="color:#f92672">.</span>get_second()
        <span style="color:#66d9ef">if</span> pos <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> stop_pos_tags:
            <span style="color:#66d9ef">if</span> pos <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;VV&#39;</span>, <span style="color:#e6db74">&#39;VA&#39;</span>, <span style="color:#e6db74">&#39;VX&#39;</span>, <span style="color:#e6db74">&#39;VCP&#39;</span>, <span style="color:#e6db74">&#39;VCN&#39;</span>]:
                morph <span style="color:#f92672">=</span> morph <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;ë‹¤&#39;</span>
            result<span style="color:#f92672">.</span>append(morph)
    <span style="color:#66d9ef">return</span> result</code></pre></div>
<p>í† í°ì„ ë§Œë“¤ê³  ë¦¬ìŠ¤íŠ¸ì— ì €ì¥í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tokens_list <span style="color:#f92672">=</span> []

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(train_df[<span style="color:#e6db74">&#39;document&#39;</span>])):
    tokens_list<span style="color:#f92672">.</span>append(tokenize(train_df[<span style="color:#e6db74">&#39;document&#39;</span>][i], stop_pos_tags))</code></pre></div>
<p>ë°ì´í„° í”„ë ˆì„ì— ë„£ì–´ì„œ í† í°ì´ ì œëŒ€ë¡œ ë§Œë“¤ì–´ ì¡ŒëŠ”ì§€ í™•ì¸í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_df[<span style="color:#e6db74">&#39;tokens&#39;</span>] <span style="color:#f92672">=</span> tokens_list

train_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>document</th>
      <th>label</th>
      <th>tokens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>ì•„ ë”ë¹™.. ì§„ì§œ ì§œì¦ë‚˜ë„¤ìš” ëª©ì†Œë¦¬</td>
      <td>0</td>
      <td>[ë”ë¹™, ì§„ì§œ, ì§œì¦, ë‚˜ë‹¤, ë„¤ìš”, ëª©ì†Œë¦¬]</td>
    </tr>
    <tr>
      <td>1</td>
      <td>í ...í¬ìŠ¤í„°ë³´ê³  ì´ˆë”©ì˜í™”ì¤„....ì˜¤ë²„ì—°ê¸°ì¡°ì°¨ ê°€ë³ì§€ ì•Šêµ¬ë‚˜</td>
      <td>1</td>
      <td>[í¬ìŠ¤í„°, ì´ˆ, ë”©, ì˜í™”, ì¤„, ì˜¤ë²„, ì—°ê¸°, ê°€ë³ë‹¤, ì§€, ì•Šë‹¤, êµ¬ë‚˜]</td>
    </tr>
    <tr>
      <td>2</td>
      <td>ë„ˆë¬´ì¬ë°“ì—ˆë‹¤ê·¸ë˜ì„œë³´ëŠ”ê²ƒì„ì¶”ì²œí•œë‹¤</td>
      <td>0</td>
      <td>[]</td>
    </tr>
    <tr>
      <td>3</td>
      <td>êµë„ì†Œ ì´ì•¼ê¸°êµ¬ë¨¼ ..ì†”ì§íˆ ì¬ë¯¸ëŠ” ì—†ë‹¤..í‰ì  ì¡°ì •</td>
      <td>0</td>
      <td>[êµë„ì†Œ, ì´ì•¼ê¸°, ì´ë‹¤, êµ¬ë¨¼, ì†”ì§íˆ, ì¬ë¯¸, ì—†ë‹¤, í‰ì , ì¡°ì •]</td>
    </tr>
    <tr>
      <td>4</td>
      <td>ì‚¬ì´ëª¬í˜ê·¸ì˜ ìµì‚´ìŠ¤ëŸ° ì—°ê¸°ê°€ ë‹ë³´ì˜€ë˜ ì˜í™”!ìŠ¤íŒŒì´ë”ë§¨ì—ì„œ ëŠ™ì–´ë³´ì´ê¸°ë§Œ í–ˆë˜ ì»¤ìŠ¤í‹´ ...</td>
      <td>1</td>
      <td>[ìµì‚´, ì—°ê¸°, ë‹ë³´ì´ë‹¤, ì—ˆ, ì˜í™”, ìŠ¤íŒŒì´, ë”, ë§¨, ëŠ™ë‹¤, ì–´, ë³´ì´ë‹¤, í•˜...</td>
    </tr>
  </tbody>
</table>
</div>

<p>í† í°ì´ ë¹„ì–´ìˆëŠ” ì—´ì€ ê³¼ê°í•˜ê²Œ ì œê±°í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">train_df <span style="color:#f92672">=</span> train_df[train_df[<span style="color:#e6db74">&#39;tokens&#39;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>len() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>]</code></pre></div>
<p>í…ŒìŠ¤íŠ¸ ë°ì´í„°ë„ ë™ì¼í•˜ê²Œ í† í°ì„ ì¶”ì¶œí•˜ê³  ë°ì´í„°í”„ë ˆì„ì— ì €ì¥í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tokens_list <span style="color:#f92672">=</span> []

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(test_df[<span style="color:#e6db74">&#39;document&#39;</span>])):
    tokens_list<span style="color:#f92672">.</span>append(tokenize(test_df[<span style="color:#e6db74">&#39;document&#39;</span>][i], stop_pos_tags))
test_df[<span style="color:#e6db74">&#39;tokens&#39;</span>] <span style="color:#f92672">=</span> tokens_list

test_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>document</th>
      <th>label</th>
      <th>tokens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>êµ³ ã…‹</td>
      <td>1</td>
      <td>[êµ³ë‹¤]</td>
    </tr>
    <tr>
      <td>1</td>
      <td>GDNTOPCLASSINTHECLUB</td>
      <td>0</td>
      <td>[]</td>
    </tr>
    <tr>
      <td>2</td>
      <td>ë­ì•¼ ì´ í‰ì ë“¤ì€.... ë‚˜ì˜ì§„ ì•Šì§€ë§Œ 10ì  ì§œë¦¬ëŠ” ë”ë”ìš± ì•„ë‹ˆì–ì•„</td>
      <td>0</td>
      <td>[ë­, ì´, í‰ì , ë“¤, ë‚˜ì˜ë‹¤, ì§€, ì•Šë‹¤, ì§€ë§Œ, ì , ì§œë¦¬, ë”ë”ìš±, ì•„ë‹ˆë‹¤,...</td>
    </tr>
    <tr>
      <td>3</td>
      <td>ì§€ë£¨í•˜ì§€ëŠ” ì•Šì€ë° ì™„ì „ ë§‰ì¥ì„... ëˆì£¼ê³  ë³´ê¸°ì—ëŠ”....</td>
      <td>0</td>
      <td>[ì§€ë£¨, ì§€, ì•Šë‹¤, ì€ë°, ì™„ì „, ë§‰ì¥, ì´ë‹¤, ëˆ, ì£¼ë‹¤, ê³ , ë³´ë‹¤]</td>
    </tr>
    <tr>
      <td>4</td>
      <td>3Dë§Œ ì•„ë‹ˆì—ˆì–´ë„ ë³„ ë‹¤ì„¯ ê°œ ì¤¬ì„í…ë°.. ì™œ 3Dë¡œ ë‚˜ì™€ì„œ ì œ ì‹¬ê¸°ë¥¼ ë¶ˆí¸í•˜ê²Œ í•˜ì£ ??</td>
      <td>0</td>
      <td>[ì•„ë‹ˆë‹¤, ì—ˆ, ì–´ë„, ë³„, ë‹¤ì„¯, ê°œ, ì£¼ë‹¤, ì—ˆ, í…, ë°, ì™œ, ë‚˜ì˜¤ë‹¤, ì•„ì„œ...</td>
    </tr>
  </tbody>
</table>
</div>

<p>í† í°ì´ ë¹„ì–´ìˆëŠ” ì—´ì€ ê³¼ê°í•˜ê²Œ ì œê±°í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">test_df <span style="color:#f92672">=</span> test_df[test_df[<span style="color:#e6db74">&#39;tokens&#39;</span>]<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>len() <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>]</code></pre></div>
<h2 id="lstm-ëª¨ë¸ë§-lstm-modeling">LSTM ëª¨ë¸ë§ (LSTM Modeling)</h2>

<p>RNNì˜ ë‹¨ì ì€ timestepì´ ì¦ê°€í•˜ë©´ ì´ì „ì˜ ì…ë ¥ ë°ì´í„° ì •ë³´ê°€ ì‚¬ë¼ì§„ë‹¤ëŠ” ê²ƒì´ë‹¤. ê¸´ ë¬¸ì¥ì˜ ê²½ìš°ì— timestepì´ ìˆ˜ë°±ê°œê°€ ë˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì¦‰ RNN ë ˆì´ì–´ê°€ ìˆ˜ë°±ê°œê°€ ë˜ë©´ ì†ì‹¤í•¨ìˆ˜ì˜ ìµœì†Œê°’ì„ ì°¾ê¸° ìœ„í•´ ë¯¸ë¶„ì˜ ë¯¸ë¶„ì˜ &hellip; ë¯¸ë¶„ì„ ìˆ˜ë°±ë²ˆì„ í•˜ê²Œ ë˜ê³  ì–´ëŠ ì§€ì  ë¶€í„° ë¯¸ë¶„ê°’ì´ 0ì´ ë˜ë©´ ê·¸ ì´ì „ì˜ ì…ë ¥ ë°ì´í„° ì •ë³´ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ëœë‹¤.</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>RNNì´ ì•Œê³ ë³´ë‹ˆ<br />
&lsquo;ë©”ë©˜í† &rsquo; ì˜€ë‹¤!</p>

<p>ê·¸ëŸ¬ë‚˜ ì—”ì§€ë‹ˆì–´ë¥¼ ë˜ ê°ˆì•„ì„œ í•´ê²°í–ˆë‹¤.<br />
ê·¸ê²ƒì€ ë°”ë¡œ&hellip;</p>
</blockquote>

<h3 id="lstm-long-short-term-memory">LSTM (Long Short-Term Memory)</h3>

<p>RNN unitì— ì´ì „ ë°ì´í„°ì˜ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ” ë©”ëª¨ë¦¬ ì…€(memory cell) í•¨ìˆ˜(\(c^{\lt t \gt}\))ì™€ ë©”ëª¨ë¦¬ ì…€ì„ ìœ ì§€í•  ê²ƒì¸ì§€ ì—…ë°ì´íŠ¸ í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •í•˜ëŠ” ê²Œì´íŠ¸(gate) í•¨ìˆ˜(\(\Gamma_u, \Gamma_f, \Gamma_o\))ë¥¼ ì¶”ê°€í•œ ê²ƒì´ LSTMì´ë‹¤.</p>

<p><img src="https://skettee.github.io/post/long_short_term_memory/lstm.png" alt="LSTM Unit" /></p>

<p>\(\begin{align}
\tilde c^{\lt t \gt} &amp; = tanh\left(W_{ca}a^{\lt t-1 \gt} + W_{cx}x^{\lt t \gt} + b_c\right) \\
\Gamma_u &amp; = \sigma \left( W_{ua}a^{\lt t-1 \gt} + W_{ux}x^{\lt t \gt} + b_u \right) \\
\Gamma_f &amp; = \sigma \left( W_{fa}a^{\lt t-1 \gt} + W_{fx}x^{\lt t \gt} + b_f \right) \\
\Gamma_o &amp; = \sigma \left( W_{oa}a^{\lt t-1 \gt} + W_{ox}x^{\lt t \gt} + b_o \right) \\
c^{\lt t \gt} &amp; = \Gamma_u * \tilde c^{\lt t \gt} + \Gamma_f * c^{\lt t-1 \gt} \\
a^{\lt t \gt} &amp; = \Gamma_o * tanh (c^{\lt t \gt}) \\
\hat y^{\lt t \gt} &amp; = W_{ya}a^{\lt t \gt} + b_y
\end{align}\)</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ê²Œì´íŠ¸(\(\Gamma\))ì˜ ì—´ê³ (\(\Gamma = 1\)) ë‹«ê³ (\(\Gamma = 0\))ë¥¼<br />
í•™ìŠµì— ì˜í•´ì„œ ê²°ì • (\((W_u, b_u), (W_f, b_f), (W_o, b_o)\)) í•œë‹¤.<br />
ê²Œì´íŠ¸(\(\Gamma\))ì˜ ìƒíƒœì— ë”°ë¼ì„œ<br />
ë©”ëª¨ë¦¬ ì…€ (\(c^{\lt t \gt}\))ì„ ì—…ë°ì´íŠ¸ í• ê±´ì§€ (\(\tilde c^{\lt t \gt}\))<br />
ì´ì „ê²ƒì„ ìœ ì§€í• ê±´ì§€ (\(c^{\lt t-1 \gt}\))
ê²°ì •í•œë‹¤.</p>

<p>íŠ¸ëœì§€ìŠ¤í„° ê°™ë„¤&hellip;</p>
</blockquote>

<h3 id="many-to-one-model">Many-to-One Model</h3>

<p>ê°ì„±ë¶„ì„(Sentiment Anaysis)ì— ì‚¬ìš©ë˜ëŠ” many to one ëª¨ë¸ì„ ì‚¬ìš©í•œë‹¤.<br />
í›ˆë ¨ ë¦¬ë·° ê°œìˆ˜ 136,927ê°œë¥¼ ì‚¬ìš©í•˜ê³ , time stepì€ 40ìœ¼ë¡œ ê³ ì •í•œë‹¤.<br />
ë¦¬ë·°ë§ˆë‹¤ í† í°ì˜ ìˆ˜ê°€ ë‹¤ë¥´ë¯€ë¡œ 40ì´ ì•ˆë˜ë©´ 0ìœ¼ë¡œ ì±„ìš°ê³ (padding) 40ì´ ë„˜ìœ¼ë©´ ê·¸ ì´ìƒì€ ì˜ë¼ ë²„ë¦°ë‹¤(clipping)</p>

<h3 id="ì •ë¦¬">ì •ë¦¬</h3>

<ol>
<li>Input Layer

<ol>
<li>Batch sizeëŠ” 136927ê°œ<br /></li>
<li>Time stepì€ 40ê°œ (\(T_x = 40\))<br /></li>
<li>Feature ê°œìˆ˜ëŠ” ì…ë ¥ì— ë“¤ì–´ê°€ëŠ” í† í° 1ê°œ<br /></li>
</ol></li>
<li>LSTM Layer

<ol>
<li>128ê°œ ìœ ë‹›ìœ¼ë¡œ êµ¬ì„±í•œë‹¤.<br /></li>
<li>Dropoutì„ 0.2ë¡œ ì„¤ì •í•œë‹¤.<br /></li>
</ol></li>
<li>Output Layer

<ol>
<li>í™œì„± í•¨ìˆ˜ëŠ” ì‹œê·¸ëª¨ì´ë“œ(Sigmoid)ë¥¼ ì‚¬ìš©í•œë‹¤.</li>
</ol></li>
<li>Loss funtion ì€ binary_crossentropy ë¥¼ ì‚¬ìš©í•œë‹¤.<br /></li>
<li>Optimizer ëŠ” Adamì„ ì‚¬ìš©í•œë‹¤.<br /></li>
</ol>

<h2 id="ì¼€ë¼ìŠ¤-keras-ë¡œ-ëª¨ë¸ë§-modeling">ì¼€ë¼ìŠ¤(Keras)ë¡œ ëª¨ë¸ë§(Modeling)</h2>

<h3 id="ë°ì´í„°-ë³€í™˜-data-transformation">ë°ì´í„° ë³€í™˜ (Data Transformation)</h3>

<p>í† í°ì„ ìˆ«ìë¡œ ë³€í™˜(Encoding)í•˜ê³ , ì…ë ¥ í† í°ì˜ ê°œìˆ˜ë¥¼ ë™ì¼í•œ í¬ê¸°ë¡œ ë§ì¶˜ë‹¤. ì¶œë ¥ì€ 0ê³¼ 1ë¡œ ë³€í™˜í•œë‹¤.</p>

<h4 id="encoding">Encoding</h4>

<p>í† í°ì„ ìˆ«ìë¡œ ë³€í™˜í•˜ê³  tokenizerë¥¼ íŒŒì¼ì— ì €ì¥í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.keras.preprocessing.text <span style="color:#f92672">import</span> Tokenizer
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> pickle

tokenizer_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;keras_naver_review_tokenizer.pickle&#39;</span>
save_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), tokenizer_name)

max_words <span style="color:#f92672">=</span> <span style="color:#ae81ff">35000</span>
tokenizer <span style="color:#f92672">=</span> Tokenizer(num_words<span style="color:#f92672">=</span>max_words, oov_token <span style="color:#f92672">=</span> True)
tokenizer<span style="color:#f92672">.</span>fit_on_texts(train_df<span style="color:#f92672">.</span>tokens)
train_df<span style="color:#f92672">.</span>tokens <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>texts_to_sequences(train_df<span style="color:#f92672">.</span>tokens)
test_df<span style="color:#f92672">.</span>tokens <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>texts_to_sequences(test_df<span style="color:#f92672">.</span>tokens)

<span style="color:#66d9ef">with</span> open(save_path, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    pickle<span style="color:#f92672">.</span>dump(tokenizer, f, protocol<span style="color:#f92672">=</span>pickle<span style="color:#f92672">.</span>HIGHEST_PROTOCOL)

train_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>document</th>
      <th>label</th>
      <th>tokens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>ì•„ ë”ë¹™.. ì§„ì§œ ì§œì¦ë‚˜ë„¤ìš” ëª©ì†Œë¦¬</td>
      <td>0</td>
      <td>[502, 31, 210, 66, 70, 716]</td>
    </tr>
    <tr>
      <td>1</td>
      <td>í ...í¬ìŠ¤í„°ë³´ê³  ì´ˆë”©ì˜í™”ì¤„....ì˜¤ë²„ì—°ê¸°ì¡°ì°¨ ê°€ë³ì§€ ì•Šêµ¬ë‚˜</td>
      <td>1</td>
      <td>[489, 305, 236, 2, 172, 1294, 42, 717, 16, 34,...</td>
    </tr>
    <tr>
      <td>3</td>
      <td>êµë„ì†Œ ì´ì•¼ê¸°êµ¬ë¨¼ ..ì†”ì§íˆ ì¬ë¯¸ëŠ” ì—†ë‹¤..í‰ì  ì¡°ì •</td>
      <td>0</td>
      <td>[5551, 138, 3, 3988, 281, 87, 17, 46, 2881]</td>
    </tr>
    <tr>
      <td>4</td>
      <td>ì‚¬ì´ëª¬í˜ê·¸ì˜ ìµì‚´ìŠ¤ëŸ° ì—°ê¸°ê°€ ë‹ë³´ì˜€ë˜ ì˜í™”!ìŠ¤íŒŒì´ë”ë§¨ì—ì„œ ëŠ™ì–´ë³´ì´ê¸°ë§Œ í–ˆë˜ ì»¤ìŠ¤í‹´ ...</td>
      <td>1</td>
      <td>[6734, 42, 845, 10, 2, 1602, 67, 414, 1156, 12...</td>
    </tr>
    <tr>
      <td>5</td>
      <td>ë§‰ ê±¸ìŒë§ˆ ë—€ 3ì„¸ë¶€í„° ì´ˆë“±í•™êµ 1í•™ë…„ìƒì¸ 8ì‚´ìš©ì˜í™”.ã…‹ã…‹ã…‹...ë³„ë°˜ê°œë„ ì•„ê¹Œì›€.</td>
      <td>0</td>
      <td>[678, 13857, 1512, 264, 1678, 1452, 471, 3, 80]</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">test_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>document</th>
      <th>label</th>
      <th>tokens</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2</td>
      <td>ë­ì•¼ ì´ í‰ì ë“¤ì€.... ë‚˜ì˜ì§„ ì•Šì§€ë§Œ 10ì  ì§œë¦¬ëŠ” ë”ë”ìš± ì•„ë‹ˆì–ì•„</td>
      <td>0</td>
      <td>[54, 18, 46, 13, 456, 16, 34, 35, 26, 605, 314...</td>
    </tr>
    <tr>
      <td>3</td>
      <td>ì§€ë£¨í•˜ì§€ëŠ” ì•Šì€ë° ì™„ì „ ë§‰ì¥ì„... ëˆì£¼ê³  ë³´ê¸°ì—ëŠ”....</td>
      <td>0</td>
      <td>[78, 16, 34, 238, 128, 340, 3, 140, 22, 5, 4]</td>
    </tr>
    <tr>
      <td>4</td>
      <td>3Dë§Œ ì•„ë‹ˆì—ˆì–´ë„ ë³„ ë‹¤ì„¯ ê°œ ì¤¬ì„í…ë°.. ì™œ 3Dë¡œ ë‚˜ì™€ì„œ ì œ ì‹¬ê¸°ë¥¼ ë¶ˆí¸í•˜ê²Œ í•˜ì£ ??</td>
      <td>0</td>
      <td>[41, 10, 243, 191, 1942, 109, 22, 10, 671, 188...</td>
    </tr>
    <tr>
      <td>5</td>
      <td>ìŒì•…ì´ ì£¼ê°€ ëœ, ìµœê³ ì˜ ìŒì•…ì˜í™”</td>
      <td>1</td>
      <td>[216, 3476, 45, 49, 216, 2]</td>
    </tr>
    <tr>
      <td>7</td>
      <td>ë§ˆì¹˜ ë¯¸êµ­ì• ë‹ˆì—ì„œ íŠ€ì–´ë‚˜ì˜¨ë“¯í•œ ì°½ì˜ë ¥ì—†ëŠ” ë¡œë´‡ë””ìì¸ë¶€í„°ê°€,ê³ ê°œë¥¼ ì –ê²Œí•œë‹¤</td>
      <td>0</td>
      <td>[1060, 395, 372, 4329, 282, 11, 6400, 17, 1378...</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">X_train <span style="color:#f92672">=</span> train_df<span style="color:#f92672">.</span>tokens
Y_train <span style="color:#f92672">=</span> train_df<span style="color:#f92672">.</span>label

X_test <span style="color:#f92672">=</span> test_df<span style="color:#f92672">.</span>tokens
Y_test <span style="color:#f92672">=</span> test_df<span style="color:#f92672">.</span>label

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;X_train shape: &#39;</span>, X_train<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Y_train shape: &#39;</span>, Y_train<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">X_test shape: &#39;</span>, X_test<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Y_test shape: &#39;</span>, Y_test<span style="color:#f92672">.</span>shape)</code></pre></div>
<pre><code>X_train shape:  (136927,)
Y_train shape:  (136927,)

X_test shape:  (45780,)
Y_test shape:  (45780,)
</code></pre>

<h4 id="padding">Padding</h4>

<p>Time stepì€ 40ìœ¼ë¡œ ê³ ì •í•œë‹¤. ë¦¬ë·°ë§ˆë‹¤ í† í°ì˜ ìˆ˜ê°€ ë‹¤ë¥´ë¯€ë¡œ 40ì´ ì•ˆë˜ë©´ 0ìœ¼ë¡œ ì±„ìš°ê³ (padding) 40ì´ ë„˜ìœ¼ë©´ ê·¸ ì´ìƒì€ ì˜ë¼ ë²„ë¦°ë‹¤(clipping)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.keras.preprocessing.sequence <span style="color:#f92672">import</span> pad_sequences

max_len<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span>
X_train <span style="color:#f92672">=</span> pad_sequences(X_train, maxlen<span style="color:#f92672">=</span>max_len)
X_test <span style="color:#f92672">=</span> pad_sequences(X_test, maxlen<span style="color:#f92672">=</span>max_len)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;X_train shape: &#39;</span>, X_train<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;X_test shape: &#39;</span>, X_test<span style="color:#f92672">.</span>shape)</code></pre></div>
<pre><code>X_train shape:  (136927, 40)
X_test shape:  (45780, 40)
</code></pre>

<h4 id="ì´ì§„-ë¶„ë¥˜-binary-classification">ì´ì§„ ë¶„ë¥˜ (Binary classification)</h4>

<p>ì¶œë ¥ ë°ì´í„°ë¥¼ 0ê³¼ 1ë¡œ ë³€í™˜í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder

encoder <span style="color:#f92672">=</span> LabelEncoder()
<span style="color:#75715e"># Train</span>
batch_size <span style="color:#f92672">=</span> Y_train<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
input_dim <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
Y_train <span style="color:#f92672">=</span> encoder<span style="color:#f92672">.</span>fit_transform(Y_train) <span style="color:#75715e"># Labeling</span>
Y_train <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>reshape(Y_train, (batch_size, input_dim)) <span style="color:#75715e"># Reshape</span>
<span style="color:#75715e"># Test</span>
batch_size <span style="color:#f92672">=</span> Y_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
Y_test <span style="color:#f92672">=</span> encoder<span style="color:#f92672">.</span>transform(Y_test) <span style="color:#75715e"># Labeling</span>
Y_test <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>reshape(Y_test, (batch_size, input_dim)) <span style="color:#75715e"># Reshape</span>

<span style="color:#66d9ef">print</span>(Y_train<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(Y_test<span style="color:#f92672">.</span>shape)</code></pre></div>
<pre><code>(136927, 1)
(45780, 1)
</code></pre>

<h3 id="ëª¨ë¸ë§-modeling">ëª¨ë¸ë§ (Modeling)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.keras <span style="color:#f92672">import</span> Sequential
<span style="color:#f92672">from</span> tensorflow.keras.layers <span style="color:#f92672">import</span> Dense, Embedding, LSTM

model <span style="color:#f92672">=</span> Sequential()
model<span style="color:#f92672">.</span>add(Embedding(max_words, <span style="color:#ae81ff">128</span>))
model<span style="color:#f92672">.</span>add(LSTM(<span style="color:#ae81ff">128</span>, dropout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>, recurrent_dropout<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>))
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">1</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sigmoid&#39;</span>))
model<span style="color:#f92672">.</span>compile(loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;binary_crossentropy&#39;</span>, optimizer<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;adam&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;accuracy&#39;</span>])</code></pre></div>
<h3 id="ëª¨ë¸-í›ˆë ¨-train-model">ëª¨ë¸ í›ˆë ¨ (Train Model)</h3>

<p>ì»¤í”¼ í•œì” í•˜ì„¸ì—¬~ â˜•ï¸</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">hist <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit(X_train, Y_train, batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)</code></pre></div>
<pre><code>Epoch 1/5
136927/136927 [==============================] - 429s 3ms/sample - loss: 0.3903 - acc: 0.8231
Epoch 2/5
136927/136927 [==============================] - 429s 3ms/sample - loss: 0.3104 - acc: 0.8662
Epoch 3/5
136927/136927 [==============================] - 430s 3ms/sample - loss: 0.2687 - acc: 0.8867
Epoch 4/5
136927/136927 [==============================] - 430s 3ms/sample - loss: 0.2322 - acc: 0.9037
Epoch 5/5
136927/136927 [==============================] - 430s 3ms/sample - loss: 0.1984 - acc: 0.9197
</code></pre>

<h3 id="ëª¨ë¸-í…ŒìŠ¤íŠ¸-test-model">ëª¨ë¸ í…ŒìŠ¤íŠ¸ (Test Model)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">loss, acc <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>evaluate(X_test, Y_test, batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Test loss:&#39;</span>, loss)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Test accuracy:&#39;</span>, acc)</code></pre></div>
<pre><code>45780/45780 [==============================] - 24s 519us/sample - loss: 0.4006 - acc: 0.8480
Test loss: 0.4006009472697622
Test accuracy: 0.8479904
</code></pre>

<h3 id="ëª¨ë¸-ì €ì¥-save-model">ëª¨ë¸ ì €ì¥ (Save Model)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os

save_dir <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
model_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;keras_naver_review_trained_model.h5&#39;</span>

<span style="color:#75715e"># Save model and weights</span>
model_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(save_dir, model_name)
model<span style="color:#f92672">.</span>save(model_path)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Saved trained model at </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> &#39;</span> <span style="color:#f92672">%</span> model_path)</code></pre></div>
<pre><code>Saved trained model at /home/dataman/myWork/deeplearning/keras_naver_review_trained_model.h5 
</code></pre>

<h2 id="í•´ê²°-solution">í•´ê²° (Solution)</h2>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>review_textì— ë¦¬ë·°ë¥¼ ì ì–´ì„œ ì‹¤í–‰í•˜ë©´<br />
ê°ì„± ë¶„ì„ ì˜ˆì¸¡ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.<br />
ì •í™•ë„ëŠ” 84% ì…ë‹ˆë‹¤.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span>  tensorflow.keras.models <span style="color:#f92672">import</span> load_model
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> pickle

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_tokenizer</span>(path):
    <span style="color:#66d9ef">with</span> open(path, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
        tokenizer <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(f)
    <span style="color:#66d9ef">return</span> tokenizer

load_dir <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
model_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;keras_naver_review_trained_model.h5&#39;</span>
tokenizer_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;keras_naver_review_tokenizer.pickle&#39;</span>
model_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(load_dir, model_name)
tokenizer_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(load_dir, tokenizer_name)

model <span style="color:#f92672">=</span> load_model(model_path)
tokenizer <span style="color:#f92672">=</span> load_tokenizer(tokenizer_path)</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> PyKomoran <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">from</span> tensorflow.keras.preprocessing.sequence <span style="color:#f92672">import</span> pad_sequences

max_len<span style="color:#f92672">=</span><span style="color:#ae81ff">40</span>
komoran <span style="color:#f92672">=</span> Komoran(<span style="color:#e6db74">&#34;STABLE&#34;</span>)
stop_pos_tags <span style="color:#f92672">=</span>  [<span style="color:#e6db74">&#39;IC&#39;</span>, <span style="color:#e6db74">&#39;JKS&#39;</span>, <span style="color:#e6db74">&#39;JKC&#39;</span>, <span style="color:#e6db74">&#39;JKG&#39;</span>, <span style="color:#e6db74">&#39;JKO&#39;</span>, <span style="color:#e6db74">&#39;JKB&#39;</span>, <span style="color:#e6db74">&#39;JKV&#39;</span>, <span style="color:#e6db74">&#39;JKQ&#39;</span>, <span style="color:#e6db74">&#39;JX&#39;</span>, 
                   <span style="color:#e6db74">&#39;EF&#39;</span>, <span style="color:#e6db74">&#39;ETN&#39;</span>, <span style="color:#e6db74">&#39;ETM&#39;</span>, <span style="color:#e6db74">&#39;XSA&#39;</span>, <span style="color:#e6db74">&#39;SF&#39;</span>, <span style="color:#e6db74">&#39;SP&#39;</span>, <span style="color:#e6db74">&#39;SS&#39;</span>, <span style="color:#e6db74">&#39;SE&#39;</span>, <span style="color:#e6db74">&#39;SO&#39;</span>, <span style="color:#e6db74">&#39;SL&#39;</span>, <span style="color:#e6db74">&#39;SH&#39;</span>, 
                   <span style="color:#e6db74">&#39;SW&#39;</span>, <span style="color:#e6db74">&#39;NF&#39;</span>, <span style="color:#e6db74">&#39;NV&#39;</span>, <span style="color:#e6db74">&#39;SN&#39;</span>, <span style="color:#e6db74">&#39;NA&#39;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">tokenize</span>(corpus, stop_pos_tags):
    result <span style="color:#f92672">=</span> []
    pairs <span style="color:#f92672">=</span> komoran<span style="color:#f92672">.</span>get_list(corpus)
    <span style="color:#66d9ef">for</span> pair <span style="color:#f92672">in</span> pairs:
        morph <span style="color:#f92672">=</span> pair<span style="color:#f92672">.</span>get_first()
        pos <span style="color:#f92672">=</span> pair<span style="color:#f92672">.</span>get_second()
        <span style="color:#66d9ef">if</span> pos <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> stop_pos_tags:
            <span style="color:#66d9ef">if</span> pos <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;VV&#39;</span>, <span style="color:#e6db74">&#39;VA&#39;</span>, <span style="color:#e6db74">&#39;VX&#39;</span>, <span style="color:#e6db74">&#39;VCP&#39;</span>, <span style="color:#e6db74">&#39;VCN&#39;</span>]:
                morph <span style="color:#f92672">=</span> morph <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;ë‹¤&#39;</span>
            result<span style="color:#f92672">.</span>append(morph)
    <span style="color:#66d9ef">return</span> result

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_sentiment</span>(text, model):
    tokens <span style="color:#f92672">=</span> []
    tokens<span style="color:#f92672">.</span>append(tokenize(text, stop_pos_tags))
    tokens <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>texts_to_sequences(tokens)
    x_test <span style="color:#f92672">=</span> pad_sequences(tokens, maxlen<span style="color:#f92672">=</span>max_len)
    predict <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(x_test)
    <span style="color:#66d9ef">if</span> predict[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.5</span>:
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;GOOD&#39;</span>
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;BAD&#39;</span>

review_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ì¬ë¯¸ìˆëŠ”ì˜í™”ì…ë‹ˆë‹¤.&#39;</span>
result <span style="color:#f92672">=</span> predict_sentiment(review_text, model)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;{} : {}&#39;</span><span style="color:#f92672">.</span>format(review_text, result))</code></pre></div>
<pre><code>ì¬ë¯¸ìˆëŠ”ì˜í™”ì…ë‹ˆë‹¤. : GOOD
</code></pre>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/pos/" rel="tag">PoS</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/tokenization/" rel="tag">Tokenization</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/lstm/" rel="tag">LSTM</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/many-to-one/" rel="tag">many-to-one</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/recurrent_neural_network/" rel="prev"><span class="post-nav__caption">Â«&thinsp;Previous</span><p class="post-nav__post-title">Recurrent Neural Network</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/post/monte_carlo_learning/" rel="next"><span class="post-nav__caption">Next&thinsp;Â»</span><p class="post-nav__post-title">Monte Carlo Learning</p></a>
	</div>
</nav>
<script src="https://utteranc.es/client.js"
        repo="skettee/blog-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 skettee.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>
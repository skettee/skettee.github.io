<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent Factor Model) - ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent Factor Model)" />
<meta property="og:description" content="ì˜í™”ë‚˜ ìƒí’ˆ ì¶”ì²œì— ì‚¬ìš©ë˜ëŠ” ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent Factor Model)ì„ ì‚´í´ ë³´ê³  Kerasë¡œ ëª¨ë¸ë§ì„ í•´ë³´ì!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/latent_factor_model/" />
<meta property="article:published_time" content="2019-09-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-06T00:00:00+00:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ" rel="home">
				<div class="logo__title">ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ</div>
				<div class="logo__tagline">ë”¥ëŸ¬ë‹ ëª¨ë¸ë§</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent Factor Model)</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-09-06T00:00:00">2019-09-06</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/deep-learning" rel="category">Deep Learning</a>, <a class="meta__link" href="/categories/recommendation" rel="category">Recommendation</a></span>
</div>
</div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#ë¬¸ì œ-problem">ë¬¸ì œ (Problem)</a></li>
<li><a href="#ë°ì´í„°-ìˆ˜ì§‘-data-collection">ë°ì´í„° ìˆ˜ì§‘ (Data Collection)</a>
<ul>
<li><a href="#ratings-ë°ì´í„°í”„ë ˆì„">Ratings ë°ì´í„°í”„ë ˆì„</a></li>
<li><a href="#movies-ë°ì´í„°í”„ë ˆì„">Movies ë°ì´í„°í”„ë ˆì„</a></li>
<li><a href="#ë²ˆ-ì‚¬ìš©ìê°€-5ê°œ-ë³„ì ì„-ì¤€-ì˜í™”-ë¦¬ìŠ¤íŠ¸">#ë²ˆ ì‚¬ìš©ìê°€ 5ê°œ ë³„ì ì„ ì¤€ ì˜í™” ë¦¬ìŠ¤íŠ¸</a></li>
</ul></li>
<li><a href="#ë°ì´í„°-ë¶„ì„-data-analysis">ë°ì´í„° ë¶„ì„ (Data Analysis)</a>
<ul>
<li><a href="#ë°ì´í„°-í™•ì¸-data-visualization">ë°ì´í„° í™•ì¸ (Data Visualization)</a></li>
<li><a href="#ë°ì´í„°-ëª¨ë¸ë§-data-modeling">ë°ì´í„° ëª¨ë¸ë§ (Data Modeling)</a></li>
<li><a href="#í–‰ë ¬-ì¸ìˆ˜-ë¶„í•´-matrix-factorization">í–‰ë ¬ ì¸ìˆ˜ ë¶„í•´ (Matrix Factorization)</a></li>
<li><a href="#ì ì¬-ì¸ìˆ˜-ëª¨ë¸-latent-factor-model">ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent factor model)</a>
<ul>
<li><a href="#ì†ì‹¤í•¨ìˆ˜-loss-function">ì†ì‹¤í•¨ìˆ˜(Loss function)</a></li>
<li><a href="#ìµœì í™”-optimization">ìµœì í™”(Optimization)</a></li>
</ul></li>
</ul></li>
<li><a href="#ë°ì´í„°-ë³€í™˜-data-transformation">ë°ì´í„° ë³€í™˜ (Data Transformation)</a></li>
<li><a href="#ëª¨ë¸ë§-modeling">ëª¨ë¸ë§ (Modeling)</a>
<ul>
<li><a href="#embedding">Embedding</a></li>
<li><a href="#ë¯¸ë‹ˆ-ë°ì´í„°ë¥¼-ê°€ì§€ê³ -modeling">ë¯¸ë‹ˆ ë°ì´í„°ë¥¼ ê°€ì§€ê³  Modeling</a></li>
<li><a href="#ëª¨ë¸-í›ˆë ¨">ëª¨ë¸ í›ˆë ¨</a></li>
<li><a href="#ì˜ˆì¸¡">ì˜ˆì¸¡</a></li>
<li><a href="#movielensë¥¼-ê°€ì§€ê³ -ëª¨ë¸ë§-modeling-í•˜ê¸°">Movielensë¥¼ ê°€ì§€ê³  ëª¨ë¸ë§(Modeling)í•˜ê¸°</a>
<ul>
<li><a href="#ë°ì´í„°-ë³€í™˜">ë°ì´í„° ë³€í™˜</a></li>
<li><a href="#latent-factor-ëª¨ë¸ë§">Latent factor ëª¨ë¸ë§</a></li>
</ul></li>
<li><a href="#ëª¨ë¸-í›ˆë ¨-ë°-í‰ê°€">ëª¨ë¸ í›ˆë ¨ ë° í‰ê°€</a></li>
</ul></li>
<li><a href="#í•´ê²°-solution">í•´ê²° (Solution)</a></li>
</ul></li>
</ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<p>ì˜í™”ë‚˜ ìƒí’ˆ ì¶”ì²œì— ì‚¬ìš©ë˜ëŠ” ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent Factor Model)ì„ ì‚´í´ ë³´ê³  Kerasë¡œ ëª¨ë¸ë§ì„ í•´ë³´ì!</p>

<p>ì‹¤ì œë¡œ ëŒë ¤ ë³´ê³  ì‹¶ìœ¼ë©´ êµ¬ê¸€ ì½”ë©ìœ¼ë¡œ ~</p>

<p><a href="https://colab.research.google.com/github/skettee/notebooks/blob/master/latent_factor_model.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>

<h2 id="ë¬¸ì œ-problem">ë¬¸ì œ (Problem)</h2>

<p>ğŸ‘¤ ìƒì‚¬</p>

<blockquote>
<p>ì¸ê³µì§€ëŠ¥ì„ ì´ìš©í•´ì„œ ì˜í™”ë¥¼ ì¶”ì²œí•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•œë‹¤<br />
ë°ì´í„°ëŠ” movielensì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê²Œ<br />
<a href="https://movielens.org/">https://movielens.org/</a></p>

<p>ì—¬ê¸°ì„œ ì œê³µí•˜ëŠ” ì˜í™” ë©”íƒ€ë°ì´í„°ì™€ ì‚¬ìš©ì ë³„ì ì„ ì´ìš©í•´ì„œ<br />
ì˜í™”ì— ëŒ€í•œ ì‚¬ìš©ìì˜ ë³„ì ì„ ì˜ˆì¸¡í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ ë³´ê²Œ</p>
</blockquote>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì•„ë‹ˆ ë³´ìŠ¤&hellip; ì‚¬ì§„ ì¸ì‹ í”„ë¡œì íŠ¸ëŠ” ì–´ë–»ê²Œ í•˜ë¼ê³ &hellip;  CNNì‹œì‘ë„ ì•ˆí–ˆëŠ”ë°&hellip;<br />
ë§‰ ì§€ë¥´ëŠ” êµ¬ë‚˜&hellip;</p>
</blockquote>

<h2 id="ë°ì´í„°-ìˆ˜ì§‘-data-collection">ë°ì´í„° ìˆ˜ì§‘ (Data Collection)</h2>

<p>ì´ì œëŠ” ë°ì´í„° ìˆ˜ì§‘ë„ ì¼ì´ ë˜ì—ˆë‹¤.<br />
ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  íŒŒì¼ë¡œ ì €ì¥í•˜ê³  ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.</p>

<p>ìš°ë¦¬ê°€ ì‚¬ìš©í•  ë¬´ë¹„ë Œì¦ˆ ë°ì´í„°ì…‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p><strong>MovieLens Latest Datasets</strong><br />
100,000 ratings and 3,600 tag applications applied to 9,000 movies by 600 users. Last updated <sup>9</sup>&frasl;<sub>2018</sub>.</p>

<ul>
<li><a href="http://files.grouplens.org/datasets/movielens/ml-latest-small-README.html">README.txt</a><br /></li>
<li>ml-latest-small.zip (size: 1 MB)</li>
<li><a href="http://files.grouplens.org/datasets/movielens/ml-latest-small.zip">http://files.grouplens.org/datasets/movielens/ml-latest-small.zip</a></li>
</ul>

<p>ZipíŒŒì¼ì„ í’€ë©´ ì•„ë˜ì˜ ë°ì´í„°ê°€ ë‚˜ì˜¨ë‹¤. (README.txt ì°¸ì¡°)</p>

<ol>
<li><p>ratings.csv</p>

<ul>
<li>íŒŒì¼ í˜•ì‹: userId, movieId, rating, timestamp</li>
<li>userId: 1 ~ 610 ì‚¬ì´ì˜ ì •ìˆ˜ê°’<br /></li>
<li>movieId: 1 ~ 193609 ì‚¬ì´ì˜ ì •ìˆ˜ê°’<br /></li>
<li>rating: 0.5 ~ 5.0 ì‚¬ì´ì˜ ë³„ì ê°’ (0.5ì”© ì¦ê°€)<br /></li>
<li>timestamp: ë³„ì ì„ ì¤€ ì‹œê°„ì„ ì´ˆë¡œ í‘œì‹œ  (1970.01.01 ë¶€í„° UTC time)<br /></li>
</ul></li>

<li><p>movies.csv</p>

<ul>
<li>íŒŒì¼ í˜•ì‹: movieId, title, genres</li>
<li>movieId: 1 ~ 193609 ì‚¬ì´ì˜ ì •ìˆ˜ê°’<br /></li>
<li>title: ì˜í™” ì œëª©<br /></li>
<li>genres: í•˜ë‚˜ ì´ìƒì˜ ì¥ë¥´ê°€ &lsquo;|&rsquo; ë¡œ ì—°ê²°ë˜ì–´ í‘œì‹œ<br />
Action, Adventure, Animation, Children&rsquo;s, Comedy, Comedy, Documentary, Drama, Fantasy, Film-Noir, Horror, Musical, Mystery, Romance, Sci-Fi, Thriller, War, Western<br /></li>
</ul></li>
</ol>

<p>ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ê³  <code>/tmp/movielens-data/</code> ì— ì €ì¥í•˜ì</p>

<pre><code class="language-python">import sys
import time

import os
import tempfile
import zipfile
from six.moves import urllib
import tensorflow as tf

def _progresshook(count, block_size, total_size):
    global start_time
    if count == 0:
        start_time = time.time()
        return
    duration = time.time() - start_time
    progress_size = int(count * block_size)
    speed = int(progress_size / (1024 * duration))
    percent = int(count * block_size * 100 / total_size)
    sys.stdout.write(&quot;\r...%d%%, %d MB, %d KB/s, %d seconds passed&quot; %
                    (percent, progress_size / (1024 * 1024), speed, duration))
    sys.stdout.flush()

DATA_DIR = &quot;/tmp/movielens-data/&quot;
DATA_SET = 'ml-latest-small'
RATINGS_FILE = &quot;ratings.csv&quot;
MOVIES_FILE = &quot;movies.csv&quot;
DATA_URL = &quot;http://files.grouplens.org/datasets/movielens/&quot;

data_subdir = os.path.join(DATA_DIR, DATA_SET)
expected_files = [&quot;{}.zip&quot;.format(DATA_SET), RATINGS_FILE, MOVIES_FILE]

tf.io.gfile.makedirs(data_subdir)
if set(expected_files).intersection(
    tf.io.gfile.listdir(data_subdir)) == set(expected_files):
    print(&quot;Dataset {} has already been downloaded&quot;.format(DATA_SET))
else:
    tf.io.gfile.makedirs(data_subdir)

    url = &quot;{}{}.zip&quot;.format(DATA_URL, DATA_SET)
    temp_dir = tempfile.mkdtemp()

    try:
        zip_path = os.path.join(temp_dir, &quot;{}.zip&quot;.format(DATA_SET))
        zip_path, _ = urllib.request.urlretrieve(url, zip_path, _progresshook)
        statinfo = os.stat(zip_path)
        print()
        print(&quot;Successfully downloaded {} {} bytes&quot;.format(zip_path, statinfo.st_size))

        zipfile.ZipFile(zip_path, &quot;r&quot;).extractall(temp_dir)

        working_dir = os.path.join(temp_dir, DATA_SET)

        tf.io.gfile.copy(os.path.join(working_dir, &quot;ratings.csv&quot;), os.path.join(temp_dir, RATINGS_FILE))
        tf.io.gfile.copy(os.path.join(working_dir, &quot;movies.csv&quot;), os.path.join(temp_dir, MOVIES_FILE))
        
        tf.io.gfile.rmtree(working_dir)

        for fname in tf.io.gfile.listdir(temp_dir):
            if not tf.io.gfile.exists(os.path.join(data_subdir, fname)):
                tf.io.gfile.copy(os.path.join(temp_dir, fname),
                                 os.path.join(data_subdir, fname))
            else:
                print(&quot;Skipping copy of {}, as it already exists in the &quot;
                             &quot;destination folder.&quot;.format(fname))
    finally:
        tf.io.gfile.rmtree(temp_dir)
</code></pre>

<pre><code>...100%, 0 MB, 782 KB/s, 1 seconds passed
Successfully downloaded /tmp/tmpgpeoa1q0/ml-latest-small.zip 978202 bytes
</code></pre>

<h3 id="ratings-ë°ì´í„°í”„ë ˆì„">Ratings ë°ì´í„°í”„ë ˆì„</h3>

<pre><code class="language-python">import pandas as pd
import numpy as np

ratings_df = pd.read_csv(os.path.join(data_subdir, RATINGS_FILE))
ratings_df.head()
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>964982703</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
      <td>964981247</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
      <td>964982224</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
      <td>964983815</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
      <td>964982931</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="movies-ë°ì´í„°í”„ë ˆì„">Movies ë°ì´í„°í”„ë ˆì„</h3>

<pre><code class="language-python">movies_df = pd.read_csv(os.path.join(data_subdir, MOVIES_FILE))
movies_df.head()
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <td>1</td>
      <td>2</td>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <td>3</td>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
    </tr>
    <tr>
      <td>4</td>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="ë²ˆ-ì‚¬ìš©ìê°€-5ê°œ-ë³„ì ì„-ì¤€-ì˜í™”-ë¦¬ìŠ¤íŠ¸">#ë²ˆ ì‚¬ìš©ìê°€ 5ê°œ ë³„ì ì„ ì¤€ ì˜í™” ë¦¬ìŠ¤íŠ¸</h3>

<pre><code class="language-python">userId = 100 # 1~610
rating = 5  # 1 ~ 5
top_movie_ids = ratings_df[(ratings_df['userId'] == userId) 
                           &amp; (ratings_df['rating'] == rating)].movieId
top_titles = movies_df[movies_df['movieId'].isin(top_movie_ids)].title

print('Top rated titles of userId {}:\n'.format(userId))
for item in top_titles:
    print(item)
</code></pre>

<pre><code>Top rated titles of userId 100:

Top Gun (1986)
Terms of Endearment (1983)
Christmas Vacation (National Lampoon's Christmas Vacation) (1989)
Officer and a Gentleman, An (1982)
Sweet Home Alabama (2002)
</code></pre>

<h2 id="ë°ì´í„°-ë¶„ì„-data-analysis">ë°ì´í„° ë¶„ì„ (Data Analysis)</h2>

<h3 id="ë°ì´í„°-í™•ì¸-data-visualization">ë°ì´í„° í™•ì¸ (Data Visualization)</h3>

<pre><code class="language-python">print('{} Ratings, {} Users, {} Movies'.format(len(ratings_df), 
                                               len(ratings_df.userId.unique()), 
                                               len(ratings_df.movieId.unique())))
</code></pre>

<pre><code>100836 Ratings, 610 Users, 9724 Movies
</code></pre>

<p>ë°ì´í„°ê°€ êµ¬ë©ì´ ë‚œ ê²ƒì´ ì—†ëŠ”ì§€ í™•ì¸</p>

<pre><code class="language-python"># Check missing data
print('missing number of userId data is ', ratings_df['userId'].isnull().sum())
print('missing number of movieId data is ', ratings_df['movieId'].isnull().sum())
print('missing number of rating data is ', ratings_df['rating'].isnull().sum())
</code></pre>

<pre><code>missing number of userId data is  0
missing number of movieId data is  0
missing number of rating data is  0
</code></pre>

<p><code>userId</code>, <code>movieId</code>, <code>rating</code> ì„¸ê°œë§Œ ê°€ì§€ê³  í”¼ì²˜ ë²¡í„°(feature vector)ë¥¼ ì¶”ì¶œí•  ì˜ˆì •ì´ë‹¤.<br />
ì¼ë‹¨ <code>userId</code>ë¥¼ ì»¬ëŸ¼(Column), <code>movieId</code>ë¥¼ ì—´(Row)ë¡œ ë§Œë“¤ì–´ì„œ <code>rating</code>ê°’ì„ í™•ì¸í•´ ë³´ì</p>

<pre><code class="language-python">df_table = ratings_df.set_index([&quot;movieId&quot;, &quot;userId&quot;]).unstack()
df_table.shape
</code></pre>

<pre><code>(9724, 1220)
</code></pre>

<pre><code class="language-python">df_table.iloc[808:817, 212:222].fillna(&quot;&quot;)
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="10" halign="left">rating</th>
    </tr>
    <tr>
      <th>userId</th>
      <th>213</th>
      <th>214</th>
      <th>215</th>
      <th>216</th>
      <th>217</th>
      <th>218</th>
      <th>219</th>
      <th>220</th>
      <th>221</th>
      <th>222</th>
    </tr>
    <tr>
      <th>movieId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1057</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1059</td>
      <td></td>
      <td>4</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>2</td>
    </tr>
    <tr>
      <td>1060</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1061</td>
      <td></td>
      <td></td>
      <td>3.5</td>
      <td></td>
      <td>3</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1064</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1066</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1068</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1073</td>
      <td></td>
      <td>3</td>
      <td></td>
      <td></td>
      <td>3</td>
      <td></td>
      <td>2.5</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1077</td>
      <td></td>
      <td></td>
      <td></td>
      <td>3</td>
      <td>2</td>
      <td></td>
      <td></td>
      <td></td>
      <td>4</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë¹µê¾¸ê°€ ë§ì´ ë³´ì¸ë‹¤&hellip;<br />
ë³„ì ì´ ë¹„ì–´ ìˆëŠ” ë¹µê¾¸ë‚œ ë¶€ë¶„ì„<br />
ìš°ë¦¬ê°€ ë§Œë“¤ ëª¨ë¸ì„ í†µí•´ì„œ<br />
ë³„ì ì„ ì˜ˆì¸¡í•´ì„œ ì±„ì›Œ ë„£ì–´ì•¼ í•œë‹¤.</p>

<p>ì–´ë–»ê²Œ?</p>
</blockquote>

<h3 id="ë°ì´í„°-ëª¨ë¸ë§-data-modeling">ë°ì´í„° ëª¨ë¸ë§ (Data Modeling)</h3>

<p>ë°ì´í„°ê°€ í¬ê³  ë¶ˆì™„ì „í•˜ë©´ ì´í•´í•˜ê¸°ë„ ì–´ë µê³  ë‹¤ë£¨ê¸°ë„ ì–´ë µë‹¤.<br />
ë¯¸ë‹ˆ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì„œ ì†”ë£¨ì…˜ì„ ì°¾ì•„ë³´ì!</p>

<p>5í¸ì˜ ì˜í™”ì— ëŒ€í•´ì„œ 4ëª…ì´ ë³„ì ì„ ë§¤ê¸´ ë°ì´í„°ê°€ ìˆë‹¤.</p>

<table>
<thead>
<tr>
<th>ì˜í™” \ í‰ê°€ì</th>
<th>Alice</th>
<th>Bob</th>
<th>Carol</th>
<th>Dave</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>ë·°í‹°ì¸ì‚¬ì´ë“œ</strong></td>
<td>5</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td><strong>ë¼ë¼ëœë“œ</strong></td>
<td>5</td>
<td>4</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td><strong>ëŸ¬ë¸ŒìŠ¤í† ë¦¬</strong></td>
<td>5</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td><strong>ë§¤íŠ¸ë¦­ìŠ¤</strong></td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>5</td>
</tr>

<tr>
<td><strong>ìŠ¤íƒ€ì›Œì¦ˆ</strong></td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>ìš°ë¦¬ëŠ” ì—¬ê¸°ì„œ ì•¨ë¦¬ìŠ¤(Alice), ë°¥(Bob), ìºë¡¤(Carol), ë°ì´ë¸Œ(Dave)ë¥¼ ë¶„ë¥˜í•  ìˆ˜ ìˆëŠ” íŠ¹ì§•ê³¼ ë·°í‹° ì¸ì‚¬ì´ë“œ, ë¼ë¼ëœë“œ, ëŸ¬ë¸Œ ìŠ¤í† ë¦¬, ë§¤íŠ¸ë¦­ìŠ¤, ìŠ¤íƒ€ì›Œì¦ˆë¥¼ ë¶„ë¥˜ í•  ìˆ˜ ìˆëŠ” íŠ¹ì§•ì„ ë°œê²¬í•  ê²ƒì´ë‹¤.</p>

<p>ìš°ì„  ì˜í™”ë¥¼ ë³´ì<br />
ë·°í‹° ì¸ì‚¬ì´ë“œ, ë¼ë¼ëœë“œ, ëŸ¬ë¸Œ ìŠ¤í† ë¦¬ëŠ” &lsquo;ë¡œë§¨í‹± ì˜í™”&rsquo;ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆê³ ,<br />
ë§¤íŠ¸ë¦­ìŠ¤ì™€ ìŠ¤íƒ€ì›Œì¦ˆëŠ” &lsquo;ê³µìƒê³¼í•™ ì˜í™”&rsquo;ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.</p>

<table>
<thead>
<tr>
<th>ì˜í™” \ íŠ¹ì§•</th>
<th>ë¡œë§¨í‹± ì˜í™”</th>
<th>ê³µìƒê³¼í•™ ì˜í™”</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>ë·°í‹°ì¸ì‚¬ì´ë“œ</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ë¼ë¼ëœë“œ</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ëŸ¬ë¸ŒìŠ¤í† ë¦¬</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ë§¤íŠ¸ë¦­ìŠ¤</strong></td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ìŠ¤íƒ€ì›Œì¦ˆ</strong></td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
</tr>
</tbody>
</table>

<p>ì‚¬ìš©ìë¥¼ ë³´ì<br />
ì•¨ë¦¬ìŠ¤ì™€ ë°¥ì€ ë¡œë§¨í‹± ì˜í™”ë¥¼ ì¢‹ì•„í•˜ê³  ê³µìƒê³¼í•™ ì˜í™”ë¥¼ ì¢‹ì•„í•˜ì§€ ì•ŠëŠ” &lsquo;ë¡œë§¨í‹±í•œ ì‚¬ëŒ&rsquo;ìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆê³ ,<br />
ìºë¡¤ê³¼ ë°ì´ë¸ŒëŠ” ê³µìƒê³¼í•™ ì˜í™”ë¥¼ ì¢‹ì•„í•˜ê³  ë¡œë§¨í‹± ì˜í™”ë¥¼ ì¢‹ì•„í•˜ì§€ ì•ŠëŠ” &lsquo;ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ&rsquo;ìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.</p>

<table>
<thead>
<tr>
<th>íŠ¹ì§• \ í‰ê°€ì</th>
<th>Alice</th>
<th>Bob</th>
<th>Carol</th>
<th>Dave</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>ë¡œë§¨í‹±í•œ ì‚¬ëŒ</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ</strong></td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
</tr>
</tbody>
</table>

<p><strong>ì ì¬ ì¸ìˆ˜(Latent factor)</strong></p>

<p>&lsquo;ë¡œë§¨í‹± ì˜í™”&rsquo;, &lsquo;ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ&rsquo;ê³¼ ê°™ì€ í”¼ì²˜(feature)ëŠ” ë°ì´í„°ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.<br />
ì´ì™€ê°™ì´ ë°ì´í„°ë“¤ ì†ì— ìˆ¨ì–´ìˆëŠ” íŠ¹ì§•ì„ <strong>ì ì¬ ì¸ìˆ˜(Latent factor)</strong> ë¼ê³  í•œë‹¤.</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì ì¬ ì¸ìˆ˜(Latent factor)ì˜ ê°’ë“¤ì´<br />
ì˜í™”ì˜ íŠ¹ì§•ì„ ë³´ì—¬ì£¼ê³ <br />
í‰ê°€ìì˜ íŠ¹ì§•ì„ ë³´ì—¬ ì£¼ë©´ì„œ<br />
ë³„ì ìˆ˜ê¹Œì§€ ë³´ì—¬ ì£¼ëŠ” ë°©ë²•ì´ ì—†ì„ê¹Œ?</p>

<p>ìˆë‹¤! ê·¸ê²ƒì€ ë°”ë¡œ&hellip;</p>
</blockquote>

<h3 id="í–‰ë ¬-ì¸ìˆ˜-ë¶„í•´-matrix-factorization">í–‰ë ¬ ì¸ìˆ˜ ë¶„í•´ (Matrix Factorization)</h3>

<p>ë³„ì  ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ \(R\)ë¼ê³  í•˜ì</p>

<p>\(R= \begin{bmatrix}
5 &amp; 5 &amp; 1 &amp; 1  \\
5 &amp; 4 &amp; 1 &amp; 1  \\
5 &amp; 5 &amp; 1 &amp; 1  \\
1 &amp; 1 &amp; 5 &amp; 5  \\
1 &amp; 1 &amp; 5 &amp; 4
\end{bmatrix}\)</p>

<p>ìš°ë¦¬ëŠ” ì´ì œ \(R\) (5X4) ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ \(Q\) (5X2)ì™€ \(P^T\) (2X4) ë§¤íŠ¸ë¦­ìŠ¤ë¡œ ë¶„í•´ë¥¼ í•  ê²ƒì´ë‹¤.</p>

<pre><code class="language-python"># Non-negative matrix factorization
from sklearn.decomposition import NMF
R = [
     [5,5,1,1],
     [5,4,1,1],
     [5,5,1,1],
     [1,1,5,5],
     [1,1,5,4],
    ]

k = 2 # number of factors
model = NMF(n_components=k)
Q = model.fit_transform(np.array(R))
P = model.components_
</code></pre>

<p>ì•„ë˜ \(Q\) ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë³´ì.</p>

<p>0ë²ˆ ì»¬ëŸ¼(Column)ì„ &lsquo;ë¡œë§¨í‹± ì˜í™”&rsquo;,<br />
1ë²ˆ ì»¬ëŸ¼(Column)ì„ &lsquo;ê³µìƒê³¼í•™ ì˜í™”&rsquo; ë¼ê³  í•˜ë©´<br />
\(Q\) ë§¤íŠ¸ë¦­ìŠ¤ëŠ” ì˜í™”ì˜ íŠ¹ì§•ì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤.</p>

<pre><code class="language-python"># Q (5X2) ë§¤íŠ¸ë¦­ìŠ¤
pd.DataFrame(Q, columns=['Romantic', 'Sci-Fi'])
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Romantic</th>
      <th>Sci-Fi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.931132</td>
      <td>0.000002</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.744253</td>
      <td>0.047301</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1.931132</td>
      <td>0.000002</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.376532</td>
      <td>2.425963</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.375488</td>
      <td>2.186905</td>
    </tr>
  </tbody>
</table>
</div>

<p>ì•„ë˜ \(P^T\) ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë³´ì.</p>

<p>0ë²ˆ ì—´(Row)ì„ &lsquo;ë¡œë§¨í‹±í•œ ì‚¬ëŒ&rsquo;,<br />
1ë²ˆ ì—´(Row)ì„ &lsquo;ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ&rsquo; ì´ë¼ê³  í•˜ë©´<br />
\(P^T\) ë§¤íŠ¸ë¦­ìŠ¤ëŠ” í‰ê°€ìì˜ íŠ¹ì§•ì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤.</p>

<pre><code class="language-python"># P (2X4) ë§¤íŠ¸ë¦­ìŠ¤
pd.DataFrame(P, index=['Romantic Guy', 'Imaginary Guy'])
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Romantic Guy</td>
      <td>2.669263</td>
      <td>2.503536</td>
      <td>0.518479</td>
      <td>0.518187</td>
    </tr>
    <tr>
      <td>Imaginary Guy</td>
      <td>0.000000</td>
      <td>0.023698</td>
      <td>2.077725</td>
      <td>1.872818</td>
    </tr>
  </tbody>
</table>
</div>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ \(Q\)ì™€ \(P^T\) ë§¤íŠ¸ë¦­ìŠ¤ê°€<br />
ë³„ì ì„ í‘œí˜„í•˜ëŠ” ì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ<br />
\(Q\)ì™€ \(P^T\)ë¥¼ ê³±í•´ ë³´ì</p>

<pre><code class="language-python">R_hat = np.dot(Q,P)
pd.DataFrame(R_hat)
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>5.154699</td>
      <td>4.834659</td>
      <td>1.001255</td>
      <td>1.000692</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4.655871</td>
      <td>4.367922</td>
      <td>1.002637</td>
      <td>0.992436</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5.154699</td>
      <td>4.834659</td>
      <td>1.001255</td>
      <td>1.000692</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.005062</td>
      <td>1.000152</td>
      <td>5.235708</td>
      <td>4.738501</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.002276</td>
      <td>0.991874</td>
      <td>4.738469</td>
      <td>4.290248</td>
    </tr>
  </tbody>
</table>
</div>

<p>\(R\)ê³¼ ê·¼ì‚¬í•œ ê°’ì´ ë‚˜ì˜¨ë‹¤.</p>

<p>ì´ë ‡ê²Œ  \(R \simeq Q \cdot P^T\) ë¥¼ <strong>í–‰ë ¬ì¸ìˆ˜ë¶„í•´(Matrix Factorization)</strong> ë¼ê³  í•œë‹¤.</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë†€ëë‹¤!</p>

<p>í‰ê°€ìë“¤ì˜ ì˜í™” í‰ì  ë§¤íŠ¸ë¦­ìŠ¤ë§Œ ê°€ì§€ê³ <br />
í‰ê°€ìë“¤ì˜ ì ì¬ ì¸ìˆ˜(latent factor)ì™€<br />
ì˜í™”ì˜ ì ì¬ ì¸ìˆ˜(latent factor)ë¥¼<br />
ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.</p>

<p>ì—¬ëŸ¬ë¶„&hellip; ìˆ˜í•™ì´ ì´ë ‡ê²Œ ì‹ ê¸°í•˜ê³ <br />
ì¬ë¯¸ìˆìŠµë‹ˆë‹¤.</p>

<p>í•™ìƒë•Œ<br />
ì—´ì‹¬íˆ í• ê±¸&hellip;</p>

<p>ê·¸ëŸ¬ë‚˜</p>

<p>ë³„ì ì´ ë¹µê¾¸ë‚œ ë°ì´í„°ì— ëŒ€í•´ì„œ<br />
ì ì¬ ì¸ìˆ˜(Latent factor)ë¥¼ ì–´ë–»ê²Œ ì°¾ì„ê¹Œ?</p>
</blockquote>

<h3 id="ì ì¬-ì¸ìˆ˜-ëª¨ë¸-latent-factor-model">ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent factor model)</h3>

<p>ì•Œê³  ìˆëŠ” ë°ì´í„°ì„¸íŠ¸(\(X, Y\))ë¥¼ í•™ìŠµí•˜ì—¬ ìƒˆë¡œìš´ ì…ë ¥ê°’(\(X_{new}\))ì— ëŒ€í•´ ì¶œë ¥ê°’(\(\hat Y\))ì„ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ì´ ì„ í˜• íšŒê·€ ëª¨ë¸ì´ë‹¤. ì ì¬ ì¸ìˆ˜ ëª¨ë¸ë„ ì„ í˜• íšŒê·€ ëª¨ë¸ê³¼ ë¹„ìŠ·í•˜ê²Œ ì†ì‹¤í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ì†ì‹¤í•¨ìˆ˜ê°€ ìµœì†Œê°€ ë˜ëŠ” \(P\)ì™€ \(Q\)ë¥¼ ì°¾ëŠ” ëª¨ë¸ì´ë‹¤.</p>

<h4 id="ì†ì‹¤í•¨ìˆ˜-loss-function">ì†ì‹¤í•¨ìˆ˜(Loss function)</h4>

<p>ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent factor model)ì—ì„œì˜ ì†ì‹¤ í•¨ìˆ˜(Loss function)ëŠ” <strong>SSE(Sum of Squared Error)</strong> ë¥¼ ì‚¬ìš©í•œë‹¤.</p>

<p>\(J(p, q) = {1 \over 2}\sum_{(i,j) \in R} (r_{ij} - q_i \cdot p_{j}^T)^2\)</p>

<p>ì—¬ê¸°ì— ê³¼ëŒ€ì í•©(Overfitting)ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ <strong>L2 Regularization</strong> ì„ ì¶”ê°€í•œë‹¤.</p>

<p>\(J(p, q) = {1 \over 2}\sum_{(i,j) \in R} (r_{ij} - q_i \cdot p_{j}^T)^2 + {1 \over 2}\lambda \sum_{i} ||q_i||^2 + {1 \over 2}\lambda \sum_{j} ||p_j||^2\)</p>

<h4 id="ìµœì í™”-optimization">ìµœì í™”(Optimization)</h4>

<p>ì†ì‹¤í•¨ìˆ˜ì˜ ìµœì†Œê°’ì„ ì°¾ê¸° ìœ„í•´ì„œ <strong>ê²½ì‚¬ í•˜ê°•ë²•(Gradient Descent)</strong> ì„ ì ìš©í•œë‹¤.</p>

<p>REPEAT(epoch) {<br />
\(p:=p-\alpha {\partial {J(p,q)}\over \partial p}\)</p>

<p>\(q:=q-\alpha {\partial{J(p,q)}\over \partial q}\) , \(\alpha\): learining rate<br />
}</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì´ì œ ë¯¸ë‹ˆ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ëª¨ë¸ë§ì„ í•´ë³´ì!</p>
</blockquote>

<pre><code class="language-python">import pandas as pd
import numpy as np

data = [
    ['Alice', 'Beauty Inside', 5],
    ['Alice', 'La La Land', 5],
    ['Alice', 'Love Story', 5],
    ['Alice', 'Matrix', 1],
    ['Alice', 'Star Wars', 1], 
    ['Bob', 'La La Land', 4],
    ['Bob', 'Love Story', 5],
    ['Bob', 'Matrix', 1],
    ['Bob', 'Star Wars', 1],
    ['Carol', 'Beauty Inside', 1],
    ['Carol', 'La La Land', 1],
    ['Carol', 'Matrix', 5],
    ['Carol', 'Star Wars', 5], 
    ['Dave', 'Beauty Inside', 1], 
    ['Dave', 'La La Land', 1],
    ['Dave', 'Love Story', 1],
    ['Dave', 'Matrix', 5],
    ['Dave', 'Star Wars', 4],
]

mini_df = pd.DataFrame( data = data, columns = ['user', 'item', 'rating'])
df_table = mini_df.set_index([&quot;item&quot;, &quot;user&quot;]).unstack().fillna('?')

df_table
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">rating</th>
    </tr>
    <tr>
      <th>user</th>
      <th>Alice</th>
      <th>Bob</th>
      <th>Carol</th>
      <th>Dave</th>
    </tr>
    <tr>
      <th>item</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Beauty Inside</td>
      <td>5.0</td>
      <td>?</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>La La Land</td>
      <td>5.0</td>
      <td>4</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>Love Story</td>
      <td>5.0</td>
      <td>5</td>
      <td>?</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>Matrix</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>Star Wars</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="ë°ì´í„°-ë³€í™˜-data-transformation">ë°ì´í„° ë³€í™˜ (Data Transformation)</h2>

<p>ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent factor model)ì—ì„œ ë°ì´í„° í›ˆë ¨ì„ ìœ„í•œ ì…ë ¥ ê°’ì€ &lsquo;í‰ê°€ì&rsquo;ì™€ &lsquo;ì˜í™”&rsquo;ì˜ ì¸ë±ìŠ¤ ê°’, ê·¸ë¦¬ê³  ë³„ì ì´ë‹¤.<br />
ë¯¸ë‹ˆ ë°ì´í„°ë¡œ ì˜ˆë¥¼ ë“¤ë©´ &lsquo;ë¼ë¼ëœë“œ&rsquo;ë¥¼ í‰ê°€í•œ &lsquo;Alice&rsquo;ì˜ í‰ì ì´ &lsquo;5.0&rsquo; ì´ë¯€ë¡œ ëª¨ë¸ì— ì…ë ¥í•˜ëŠ” ê°’ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<ul>
<li>ë¼ë¼ëœë“œë¥¼ ì¸ë±ì‹±í•œ ê°’: 1</li>
<li>ì•¨ë¦¬ìŠ¤ë¥¼ ì¸ë±ì‹±í•œ ê°’: 0</li>
<li>ë³„ì  5.0</li>
</ul>

<p>ë”°ë¼ì„œ ì˜í™” ë¦¬ìŠ¤íŠ¸ì™€ í‰ê°€ì ë¦¬ìŠ¤íŠ¸ë¥¼ ê²¹ì¹˜ì§€ ì•Šê²Œ ì¸ë±ì‹± ê°’ìœ¼ë¡œ ë³€í™˜í•´ì•¼ í•œë‹¤.</p>

<p>ë‹¤ìŒì€ ë¯¸ë‹ˆ ë°ì´í„°ì—ì„œ í‰ê°€ì(<code>user</code>)ë¥¼ ì¸ë±ì‹±í•œ ê²°ê³¼ì´ë‹¤.<br />
ì•¨ë¦¬ìŠ¤ëŠ” 0, ë°¥ì€ 1, ìºëŸ´ì€ 2, ë°ì´ë¸ŒëŠ” 3ìœ¼ë¡œ ë³€í™˜ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<pre><code class="language-python">mini_df.user = mini_df.user.astype('category').cat.codes.values
df_table = mini_df.set_index([&quot;item&quot;, &quot;user&quot;]).unstack().fillna('?')

df_table
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">rating</th>
    </tr>
    <tr>
      <th>user</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
    <tr>
      <th>item</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Beauty Inside</td>
      <td>5.0</td>
      <td>?</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>La La Land</td>
      <td>5.0</td>
      <td>4</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>Love Story</td>
      <td>5.0</td>
      <td>5</td>
      <td>?</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>Matrix</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>Star Wars</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>ì˜í™”(<code>item</code>)ì˜ ê²½ìš°ë„ ì¸ë±ì‹±ì„ í•œë‹¤.<br />
ë·°í‹°ì¸ì‚¬ì´ë“œê°€ 0, ë¼ë¼ëœë“œê°€ 1, ëŸ¬ë¸ŒìŠ¤í† ë¦¬ê°€ 2, ë§¤íŠ¸ë¦­ìŠ¤ê°€ 3, ìŠ¤íƒ€ì›Œì¦ˆ 4ë¡œ ë³€í™˜ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p>

<pre><code class="language-python">mini_df.item = mini_df.item.astype('category').cat.codes.values
df_table = mini_df.set_index([&quot;item&quot;, &quot;user&quot;]).unstack().fillna('?')

df_table
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="4" halign="left">rating</th>
    </tr>
    <tr>
      <th>user</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
    <tr>
      <th>item</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>5.0</td>
      <td>?</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>1</td>
      <td>5.0</td>
      <td>4</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5.0</td>
      <td>5</td>
      <td>?</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>

<h2 id="ëª¨ë¸ë§-modeling">ëª¨ë¸ë§ (Modeling)</h2>

<p>ì ì¬ ì¸ìˆ˜ ëª¨ë¸ì—ì„œ í•„ìš”í•œ Embeddingì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.</p>

<h3 id="embedding">Embedding</h3>

<p>ì„ë² ë”©(Embedding)ì€ ì ì¬ ì¸ìˆ˜ (Latent factor)ë¥¼ ìƒì„±í•œë‹¤.<br />
ì˜í™”(<code>item</code>)ì˜ ì ì¬ ì¸ìˆ˜ì™€ ì ì¬ ë²¡í„°ëŠ” ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•œë‹¤.</p>

<pre><code class="language-python">from tensorflow.keras import Model
from tensorflow.keras.layers import Input, Embedding, Flatten, dot
from tensorflow.keras import regularizers

n_items = len(mini_df.item.unique()) # 5í¸ì˜ ì˜í™”
n_items_latent_factors = 2 # ì˜í™”ì˜ ì ì¬ ì¸ìˆ˜ ê°œìˆ˜

item_input = Input(shape=[1])
# Item latent factor
item_embedding = Embedding(n_items, n_items_latent_factors, # (5X2) Latent factor
                           name='item_embedding')(item_input)
# Item latent vector
item_vec = Flatten()(item_embedding)
</code></pre>

<pre><code>WARNING: Logging before flag parsing goes to stderr.
W0906 18:42:21.169342 140660089382720 deprecation.py:506] From /home/dataman/anaconda3/lib/python3.7/site-packages/tensorflow/python/keras/initializers.py:119: calling RandomUniform.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
</code></pre>

<p>í‰ê°€ì(<code>user</code>)ì˜ ì ì¬ ì¸ìˆ˜ì™€ ì ì¬ ë²¡í„°ë¥¼ ìƒì„±í•œë‹¤.</p>

<pre><code class="language-python">n_users = len(mini_df.user.unique()) # 4ëª…ì˜ í‰ê°€ì
n_users_latent_factors = 2 # í‰ê°€ìì˜ ì ì¬ ì¸ìˆ˜ ê°œìˆ˜

user_input = Input(shape=[1])
# User latent factor
user_embedding = Embedding(n_users, n_users_latent_factors, # (4X2) Latent factor
                           name='user_embedding')(user_input)
# User latent vector
user_vec = Flatten()(user_embedding)
</code></pre>

<h3 id="ë¯¸ë‹ˆ-ë°ì´í„°ë¥¼-ê°€ì§€ê³ -modeling">ë¯¸ë‹ˆ ë°ì´í„°ë¥¼ ê°€ì§€ê³  Modeling</h3>

<p>\(\hat R = Q \cdot P^T\)</p>

<pre><code class="language-python">r_hat = dot([item_vec, user_vec], axes=-1)
mini_model = Model([user_input, item_input], r_hat)
mini_model.compile(optimizer = 'sgd', loss = 'mean_squared_error')
</code></pre>

<h3 id="ëª¨ë¸-í›ˆë ¨">ëª¨ë¸ í›ˆë ¨</h3>

<pre><code class="language-python">hist = mini_model.fit([mini_df.user, mini_df.item], mini_df.rating, epochs=2000, verbose=0) 
print('loss: ', hist.history['loss'][-1])

%matplotlib inline
import matplotlib.pyplot as plt

plt.plot(hist.history['loss'])
plt.xlabel('epoch')
plt.ylabel('loss')
plt.show()
</code></pre>

<pre><code>loss:  0.03074105642735958
</code></pre>

<p><img src="output_44_1.png" alt="png" /></p>

<h3 id="ì˜ˆì¸¡">ì˜ˆì¸¡</h3>

<p>ì´ì œ ë¹µê¾¸ë‚œ ë³„ì ì„ ì˜ˆì¸¡í•´ ë³´ì</p>

<pre><code class="language-python">Q = mini_model.get_layer(name='item_embedding').get_weights()[0]
P = mini_model.get_layer(name='user_embedding').get_weights()[0]
P_t = np.transpose(P)

R_hat = np.dot(Q, P_t)
pd.DataFrame(R_hat)
</code></pre>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.999927</td>
      <td>4.525294</td>
      <td>1.004016</td>
      <td>0.994853</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4.739066</td>
      <td>4.290169</td>
      <td>1.003192</td>
      <td>0.989438</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5.235585</td>
      <td>4.737882</td>
      <td>1.014246</td>
      <td>1.008297</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.002523</td>
      <td>1.002334</td>
      <td>5.235493</td>
      <td>4.738781</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.001823</td>
      <td>0.992321</td>
      <td>4.738204</td>
      <td>4.290364</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="language-python">print('ë·°í‹° ì¸ì‚¬ì´ë“œì— ëŒ€í•œ Bobì˜ ì˜ˆìƒ ë³„ì ì€ {:.1f}'.format(R_hat[0][1]))
print('ëŸ¬ë¸Œ ìŠ¤í† ë¦¬ì— ëŒ€í•œ Carolì˜ ì˜ˆìƒ ë³„ì ì€ {:.1f} ì´ë‹¤.'.format(R_hat[2][2]))
</code></pre>

<pre><code>ë·°í‹° ì¸ì‚¬ì´ë“œì— ëŒ€í•œ Bobì˜ ì˜ˆìƒ ë³„ì ì€ 4.5
ëŸ¬ë¸Œ ìŠ¤í† ë¦¬ì— ëŒ€í•œ Carolì˜ ì˜ˆìƒ ë³„ì ì€ 1.0 ì´ë‹¤.
</code></pre>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ìš°ë¦¬ê°€ ì˜ˆìƒí•œ ë³„ì ê³¼ ê°€ê¹ê²Œ ì˜ˆì¸¡ì„ í•˜ê³  ìˆë‹¤!</p>

<p>ì´ì œ Movielensì˜ ë³„ì  ì •ë³´ë¥¼ ê°€ì§€ê³  ëª¨ë¸ë§ì„ í•˜ì</p>
</blockquote>

<h3 id="movielensë¥¼-ê°€ì§€ê³ -ëª¨ë¸ë§-modeling-í•˜ê¸°">Movielensë¥¼ ê°€ì§€ê³  ëª¨ë¸ë§(Modeling)í•˜ê¸°</h3>

<h4 id="ë°ì´í„°-ë³€í™˜">ë°ì´í„° ë³€í™˜</h4>

<p>í›ˆë ¨ ë°ì´í„°ëŠ” <code>ratings_df</code>ì—ì„œ ëœë¤í•˜ê²Œ 80%ë¥¼ ì„ íƒí•˜ê³ ,<br />
í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” ë‚˜ë¨¸ì§€ 20%ë¥¼ ëœë¤í•˜ê²Œ ì„ íƒí•œë‹¤.</p>

<pre><code class="language-python">movielens_df = ratings_df.copy()

# Indexing userId and movieId
users = movielens_df.userId.unique()
movies = movielens_df.movieId.unique()

userid2idx = {o:i for i,o in enumerate(users)}
movieid2idx = {o:i for i,o in enumerate(movies)}

movielens_df['userId'] = movielens_df['userId'].apply(lambda x: userid2idx[x])
movielens_df['movieId'] = movielens_df['movieId'].apply(lambda x: movieid2idx[x])

# Split train and test data
split = np.random.rand(len(movielens_df)) &lt; 0.8

train_df = movielens_df[split]
test_df = movielens_df[~split]

print('shape of train data is ',train_df.shape)
print('shape of test data is ',test_df.shape)
</code></pre>

<pre><code>shape of train data is  (80863, 4)
shape of test data is  (19973, 4)
</code></pre>

<h4 id="latent-factor-ëª¨ë¸ë§">Latent factor ëª¨ë¸ë§</h4>

<pre><code class="language-python">n_movies = len(movielens_df.movieId.unique())
n_users = len(movielens_df.userId.unique())
n_latent_factors = 64

movie_input = Input(shape=[1])
# Item latent factor
movie_embedding = Embedding(n_movies, n_latent_factors,
                           name='movie_embedding')(movie_input)
# Item latent vector
movie_vec = Flatten()(movie_embedding)

user_input = Input(shape=[1])
# User latent factor
user_embedding = Embedding(n_users, n_latent_factors,
                           name='user_embedding')(user_input)
# User latent vector
user_vec = Flatten()(user_embedding)

r_hat = dot([movie_vec, user_vec], axes=-1)
model = Model([user_input, movie_input], r_hat)
model.compile(optimizer = 'adam', loss = 'mean_squared_error')
</code></pre>

<h3 id="ëª¨ë¸-í›ˆë ¨-ë°-í‰ê°€">ëª¨ë¸ í›ˆë ¨ ë° í‰ê°€</h3>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ëŒë ¤ë†“ê³  ì»¤í”¼ í•œì” í•˜ì„¸ì—¬~</p>
</blockquote>

<pre><code class="language-python">hist = model.fit([train_df.userId, train_df.movieId], train_df.rating, 
                 batch_size=128, epochs=50, verbose=0, 
                 validation_data = ([test_df.userId, test_df.movieId],test_df.rating)) 
print('train loss: ', hist.history['loss'][-1])
print('test loss: ', hist.history['val_loss'][-1])

%matplotlib inline
import matplotlib.pyplot as plt

plt.plot(hist.history['loss'], 'b')
plt.plot(hist.history['val_loss'] , 'r')
plt.xlabel('epoch')
plt.ylabel('loss')
plt.legend(['train', 'test'], loc='upper left')
plt.show()
</code></pre>

<pre><code>train loss:  0.015583596717465682
test loss:  1.4580945893663293
</code></pre>

<p><img src="output_54_1.png" alt="png" /></p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ìŒ&hellip;<br />
ê°œì„  ì‚¬í•­ì´ ë³´ì´ì§€ë§Œ<br />
ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì</p>
</blockquote>

<h2 id="í•´ê²°-solution">í•´ê²° (Solution)</h2>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë³´ìŠ¤~ ì›í•˜ì‹œëŠ” ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.</p>

<p>userId, movieId ê°’ì„ ì…ë ¥í•˜ì‹œë©´<br />
ì˜ˆìƒë˜ëŠ” ë³„ì ê°’ì´ ì¶œë ¥ ë©ë‹ˆë‹¤.</p>
</blockquote>

<pre><code class="language-python">userId = 214       # 1 ~ 610
movieId = 1059  # 1 ~ 193609
movie_title = list(movies_df[movies_df['movieId']==movieId].title)[0]

user_v = np.expand_dims(userid2idx[userId], 0)
movie_v = np.expand_dims(movieid2idx[movieId], 0)
predict = model.predict([user_v, movie_v])

print('ì˜í™” {} ì— ëŒ€í•œ ì‚¬ìš©ì ID {}ë‹˜ì˜ ì˜ˆìƒ ë³„ì ì€ {:.1f} ì…ë‹ˆë‹¤.'.format(movie_title, userId, predict[0][0]))
</code></pre>

<pre><code>ì˜í™” William Shakespeare's Romeo + Juliet (1996) ì— ëŒ€í•œ ì‚¬ìš©ì ID 214ë‹˜ì˜ ì˜ˆìƒ ë³„ì ì€ 4.0 ì…ë‹ˆë‹¤.
</code></pre>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/latent-factor/" rel="tag">Latent factor</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/matrix-factorization/" rel="tag">Matrix Factorization</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/embedding/" rel="tag">Embedding</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/neural_network_mnist/" rel="prev"><span class="post-nav__caption">Â«&thinsp;Previous</span><p class="post-nav__post-title">ë‰´ëŸ´ ë„¤íŠ¸ì›Œí¬ (NN) - MNIST</p></a>
	</div>
</nav>
<script src="https://utteranc.es/client.js"
        repo="skettee/blog-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 skettee.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>
<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent Factor Model) - ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent Factor Model)" />
<meta property="og:description" content="ì˜í™”ë‚˜ ìƒí’ˆ ì¶”ì²œì— ì‚¬ìš©ë˜ëŠ” ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent Factor Model)ì„ ì‚´í´ ë³´ê³  Kerasë¡œ ëª¨ë¸ë§ì„ í•´ë³´ì!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/latent_factor_model/" />
<meta property="article:published_time" content="2019-09-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-09-09T00:00:00+00:00" />

	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ" rel="home">
				<div class="logo__title">ë§‰ë¼ë¨¹ì€ ì—”ì§€ë‹ˆì–´ì˜ ë¨¸ì‹ ëŸ°ë‹ ê°œë°œ</div>
				<div class="logo__tagline">ë”¥ëŸ¬ë‹ ëª¨ë¸ë§</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent Factor Model)</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2019-09-09T00:00:00">2019-09-09</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/deep-learning" rel="category">Deep Learning</a>, <a class="meta__link" href="/categories/recommendation" rel="category">Recommendation</a></span>
</div>
</div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#ë¬¸ì œ-problem">ë¬¸ì œ (Problem)</a></li>
<li><a href="#ë°ì´í„°-ìˆ˜ì§‘-data-collection">ë°ì´í„° ìˆ˜ì§‘ (Data Collection)</a>
<ul>
<li><a href="#ratings-ë°ì´í„°í”„ë ˆì„">Ratings ë°ì´í„°í”„ë ˆì„</a></li>
<li><a href="#movies-ë°ì´í„°í”„ë ˆì„">Movies ë°ì´í„°í”„ë ˆì„</a></li>
</ul></li>
<li><a href="#ë°ì´í„°-í´ë Œì§•-data-cleansing">ë°ì´í„° í´ë Œì§• (Data Cleansing)</a></li>
<li><a href="#ë°ì´í„°-ë¶„ì„-data-analysis">ë°ì´í„° ë¶„ì„ (Data Analysis)</a></li>
<li><a href="#ë¯¸ë‹ˆ-ë°ì´í„°-mini-data">ë¯¸ë‹ˆ ë°ì´í„° (Mini Data)</a>
<ul>
<li><a href="#ì ì¬-ì¸ìˆ˜-latent-factor">ì ì¬ ì¸ìˆ˜ (Latent factor)</a></li>
<li><a href="#í–‰ë ¬-ì¸ìˆ˜-ë¶„í•´-matrix-factorization">í–‰ë ¬ ì¸ìˆ˜ ë¶„í•´ (Matrix Factorization)</a></li>
<li><a href="#ì ì¬-ì¸ìˆ˜-ì°¾ê¸°">ì ì¬ ì¸ìˆ˜ ì°¾ê¸°</a></li>
<li><a href="#kerasë¥¼-ì´ìš©í•œ-ë¯¸ë‹ˆ-ëª¨ë¸ë§">Kerasë¥¼ ì´ìš©í•œ ë¯¸ë‹ˆ ëª¨ë¸ë§</a>
<ul>
<li><a href="#ë°ì´í„°-ë³€í™˜-data-transformation">ë°ì´í„° ë³€í™˜ (Data Transformation)</a></li>
<li><a href="#ì„ë² ë”©-embedding">ì„ë² ë”© (Embedding)</a></li>
<li><a href="#ë²¡í„°í™”-flattern">ë²¡í„°í™” (Flattern)</a></li>
<li><a href="#ë¯¸ë‹ˆ-ëª¨ë¸ë§-modeling">ë¯¸ë‹ˆ ëª¨ë¸ë§ (Modeling)</a></li>
<li><a href="#ë¯¸ë‹ˆ-ëª¨ë¸-í›ˆë ¨-train-model">ë¯¸ë‹ˆ ëª¨ë¸ í›ˆë ¨ (Train Model)</a></li>
<li><a href="#ë¯¸ë‹ˆ-ì˜ˆì¸¡-predict">ë¯¸ë‹ˆ ì˜ˆì¸¡ (Predict)</a></li>
</ul></li>
</ul></li>
<li><a href="#ì ì¬-ì¸ìˆ˜-ëª¨ë¸ë§-latent-factor-modeling">ì ì¬ ì¸ìˆ˜ ëª¨ë¸ë§ (Latent Factor Modeling)</a>
<ul>
<li><a href="#ì†ì‹¤í•¨ìˆ˜-loss-function">ì†ì‹¤í•¨ìˆ˜ (Loss function)</a></li>
<li><a href="#ìµœì í™”-optimization">ìµœì í™” (Optimization)</a></li>
<li><a href="#ì •ë¦¬">ì •ë¦¬</a></li>
</ul></li>
<li><a href="#ì¼€ë¼ìŠ¤-keras-ë¡œ-ëª¨ë¸ë§-modeling">ì¼€ë¼ìŠ¤(Keras)ë¡œ ëª¨ë¸ë§(Modeling)</a>
<ul>
<li><a href="#ë°ì´í„°-ë³€í™˜">ë°ì´í„° ë³€í™˜</a></li>
<li><a href="#í›ˆë ¨-í…ŒìŠ¤íŠ¸-ë°ì´í„°-ë¶„í• ">í›ˆë ¨, í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„í• </a></li>
<li><a href="#ì„ë² ë”©-embedding-1">ì„ë² ë”© (Embedding)</a></li>
<li><a href="#ë²¡í„°í™”-flatten">ë²¡í„°í™” (Flatten)</a></li>
<li><a href="#ëª¨ë¸ë§-modeling">ëª¨ë¸ë§ (Modeling)</a></li>
<li><a href="#ëª¨ë¸-í›ˆë ¨-train-model">ëª¨ë¸ í›ˆë ¨ (Train Model)</a></li>
<li><a href="#ëª¨ë¸-í‰ê°€-test-model">ëª¨ë¸ í‰ê°€ (Test Model)</a></li>
</ul></li>
<li><a href="#í•´ê²°-solution">í•´ê²° (Solution)</a></li>
</ul></li>
</ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<p>ì˜í™”ë‚˜ ìƒí’ˆ ì¶”ì²œì— ì‚¬ìš©ë˜ëŠ” ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent Factor Model)ì„ ì‚´í´ ë³´ê³  Kerasë¡œ ëª¨ë¸ë§ì„ í•´ë³´ì!</p>

<p>ì‹¤ì œë¡œ ëŒë ¤ ë³´ê³  ì‹¶ìœ¼ë©´ êµ¬ê¸€ ì½”ë©ìœ¼ë¡œ ~</p>

<p><a href="https://colab.research.google.com/github/skettee/notebooks/blob/master/latent_factor_model.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a></p>

<h2 id="ë¬¸ì œ-problem">ë¬¸ì œ (Problem)</h2>

<p>ğŸ‘¤ ìƒì‚¬</p>

<blockquote>
<p>ì¸ê³µì§€ëŠ¥ì„ ì´ìš©í•´ì„œ ì˜í™”ë¥¼ ì¶”ì²œí•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•œë‹¤<br />
ë°ì´í„°ëŠ” movielensì—ì„œ ì œê³µí•˜ëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê²Œ<br />
<a href="https://movielens.org/">https://movielens.org/</a></p>

<p>ì—¬ê¸°ì„œ ì œê³µí•˜ëŠ” ì˜í™” ë©”íƒ€ë°ì´í„°ì™€ ì‚¬ìš©ì ë³„ì ì„ ì´ìš©í•´ì„œ<br />
ì˜í™”ì— ëŒ€í•œ ì‚¬ìš©ìì˜ ë³„ì ì„ ì˜ˆì¸¡í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ì–´ ë³´ê²Œ</p>
</blockquote>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì•„ë‹ˆ ë³´ìŠ¤&hellip; ì‚¬ì§„ ì¸ì‹ í”„ë¡œì íŠ¸ëŠ” ì–´ë–»ê²Œ í•˜ë¼ê³ &hellip;<br />
ë§‰ ì§€ë¥´ëŠ” êµ¬ë‚˜&hellip;</p>
</blockquote>

<h2 id="ë°ì´í„°-ìˆ˜ì§‘-data-collection">ë°ì´í„° ìˆ˜ì§‘ (Data Collection)</h2>

<p>ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  íŒŒì¼ë¡œ ì €ì¥í•˜ê³  ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.</p>

<p>ìš°ë¦¬ê°€ ì‚¬ìš©í•  ë¬´ë¹„ë Œì¦ˆ ë°ì´í„°ì…‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p><strong>MovieLens Latest Datasets</strong><br />
100,000 ratings and 3,600 tag applications applied to 9,000 movies by 600 users. Last updated <sup>9</sup>&frasl;<sub>2018</sub>.</p>

<ul>
<li><a href="http://files.grouplens.org/datasets/movielens/ml-latest-small-README.html">README.txt</a><br /></li>
<li>ml-latest-small.zip (size: 1 MB)</li>
<li><a href="http://files.grouplens.org/datasets/movielens/ml-latest-small.zip">http://files.grouplens.org/datasets/movielens/ml-latest-small.zip</a></li>
</ul>

<p>ZipíŒŒì¼ì„ í’€ë©´ ì•„ë˜ì˜ ë°ì´í„°ê°€ ë‚˜ì˜¨ë‹¤. (README.txt ì°¸ì¡°)</p>

<ol>
<li><p>ratings.csv</p>

<ul>
<li>íŒŒì¼ í˜•ì‹: userId, movieId, rating, timestamp</li>
<li>userId: 1 ~ 610 ì‚¬ì´ì˜ ì •ìˆ˜ê°’<br /></li>
<li>movieId: 1 ~ 193609 ì‚¬ì´ì˜ ì •ìˆ˜ê°’<br /></li>
<li>rating: 0.5 ~ 5.0 ì‚¬ì´ì˜ ë³„ì ê°’ (0.5ì”© ì¦ê°€)<br /></li>
<li>timestamp: ë³„ì ì„ ì¤€ ì‹œê°„ì„ ì´ˆë¡œ í‘œì‹œ  (1970.01.01 ë¶€í„° UTC time)<br /></li>
</ul></li>

<li><p>movies.csv</p>

<ul>
<li>íŒŒì¼ í˜•ì‹: movieId, title, genres</li>
<li>movieId: 1 ~ 193609 ì‚¬ì´ì˜ ì •ìˆ˜ê°’<br /></li>
<li>title: ì˜í™” ì œëª©<br /></li>
<li>genres: í•˜ë‚˜ ì´ìƒì˜ ì¥ë¥´ê°€ &lsquo;|&rsquo; ë¡œ ì—°ê²°ë˜ì–´ í‘œì‹œ<br />
Action, Adventure, Animation, Children&rsquo;s, Comedy, Comedy, Documentary, Drama, Fantasy, Film-Noir, Horror, Musical, Mystery, Romance, Sci-Fi, Thriller, War, Western<br /></li>
</ul></li>
</ol>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ í•˜ê³  ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•˜ì</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.keras.utils <span style="color:#f92672">import</span> get_file
<span style="color:#f92672">import</span> os

zip_fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ml-latest-small.zip&#39;</span>
data_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ml-latest-small&#39;</span>
ratings_fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ratings.csv&#39;</span>
movies_fname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;movies.csv&#39;</span>
origin <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://files.grouplens.org/datasets/movielens/ml-latest-small.zip&#39;</span>
path <span style="color:#f92672">=</span> get_file(zip_fname, origin, extract<span style="color:#f92672">=</span>True)

path <span style="color:#f92672">=</span> path<span style="color:#f92672">.</span>replace(zip_fname, data_dir)
ratings_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path, ratings_fname)
movies_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path, movies_fname)</code></pre></div>
<h3 id="ratings-ë°ì´í„°í”„ë ˆì„">Ratings ë°ì´í„°í”„ë ˆì„</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

ratings_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(ratings_path)
ratings_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>userId</th>
      <th>movieId</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>4.0</td>
      <td>964982703</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>3</td>
      <td>4.0</td>
      <td>964981247</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1</td>
      <td>6</td>
      <td>4.0</td>
      <td>964982224</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1</td>
      <td>47</td>
      <td>5.0</td>
      <td>964983815</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1</td>
      <td>50</td>
      <td>5.0</td>
      <td>964982931</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="movies-ë°ì´í„°í”„ë ˆì„">Movies ë°ì´í„°í”„ë ˆì„</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">movies_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(movies_path)
movies_df<span style="color:#f92672">.</span>head()</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movieId</th>
      <th>title</th>
      <th>genres</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1</td>
      <td>Toy Story (1995)</td>
      <td>Adventure|Animation|Children|Comedy|Fantasy</td>
    </tr>
    <tr>
      <td>1</td>
      <td>2</td>
      <td>Jumanji (1995)</td>
      <td>Adventure|Children|Fantasy</td>
    </tr>
    <tr>
      <td>2</td>
      <td>3</td>
      <td>Grumpier Old Men (1995)</td>
      <td>Comedy|Romance</td>
    </tr>
    <tr>
      <td>3</td>
      <td>4</td>
      <td>Waiting to Exhale (1995)</td>
      <td>Comedy|Drama|Romance</td>
    </tr>
    <tr>
      <td>4</td>
      <td>5</td>
      <td>Father of the Bride Part II (1995)</td>
      <td>Comedy</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>#ë²ˆ ì‚¬ìš©ìê°€ 5ê°œ ë³„ì ì„ ì¤€ ì˜í™” ë¦¬ìŠ¤íŠ¸</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">userId <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> <span style="color:#75715e"># 1~610</span>
rating <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>  <span style="color:#75715e"># 1 ~ 5</span>
top_movie_ids <span style="color:#f92672">=</span> ratings_df[(ratings_df[<span style="color:#e6db74">&#39;userId&#39;</span>] <span style="color:#f92672">==</span> userId) 
                           <span style="color:#f92672">&amp;</span> (ratings_df[<span style="color:#e6db74">&#39;rating&#39;</span>] <span style="color:#f92672">==</span> rating)]<span style="color:#f92672">.</span>movieId
top_titles <span style="color:#f92672">=</span> movies_df[movies_df[<span style="color:#e6db74">&#39;movieId&#39;</span>]<span style="color:#f92672">.</span>isin(top_movie_ids)]<span style="color:#f92672">.</span>title

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Top rated titles of userId {}:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>format(userId))
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> top_titles:
    <span style="color:#66d9ef">print</span>(item)</code></pre></div>
<pre><code>Top rated titles of userId 100:

Top Gun (1986)
Terms of Endearment (1983)
Christmas Vacation (National Lampoon's Christmas Vacation) (1989)
Officer and a Gentleman, An (1982)
Sweet Home Alabama (2002)
</code></pre>

<h2 id="ë°ì´í„°-í´ë Œì§•-data-cleansing">ë°ì´í„° í´ë Œì§• (Data Cleansing)</h2>

<p>ë°ì´í„°ê°€ êµ¬ë©ì´ ë‚œ ê²ƒì´ ì—†ëŠ”ì§€ í™•ì¸</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Check missing data</span>
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;missing number of userId data is &#39;</span>, ratings_df[<span style="color:#e6db74">&#39;userId&#39;</span>]<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum())
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;missing number of movieId data is &#39;</span>, ratings_df[<span style="color:#e6db74">&#39;movieId&#39;</span>]<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum())
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;missing number of rating data is &#39;</span>, ratings_df[<span style="color:#e6db74">&#39;rating&#39;</span>]<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum())</code></pre></div>
<pre><code>missing number of userId data is  0
missing number of movieId data is  0
missing number of rating data is  0
</code></pre>

<h2 id="ë°ì´í„°-ë¶„ì„-data-analysis">ë°ì´í„° ë¶„ì„ (Data Analysis)</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;{} Ratings, {} Users, {} Movies&#39;</span><span style="color:#f92672">.</span>format(len(ratings_df), 
                                               len(ratings_df<span style="color:#f92672">.</span>userId<span style="color:#f92672">.</span>unique()), 
                                               len(ratings_df<span style="color:#f92672">.</span>movieId<span style="color:#f92672">.</span>unique())))</code></pre></div>
<pre><code>100836 Ratings, 610 Users, 9724 Movies
</code></pre>

<p><code>userId</code>ë¥¼ ì»¬ëŸ¼(Column), <code>movieId</code>ë¥¼ ì—´(Row)ë¡œ ë§Œë“¤ì–´ì„œ <code>rating</code>ê°’ì„ í™•ì¸í•´ ë³´ì</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_table <span style="color:#f92672">=</span> ratings_df<span style="color:#f92672">.</span>set_index([<span style="color:#e6db74">&#34;movieId&#34;</span>, <span style="color:#e6db74">&#34;userId&#34;</span>])<span style="color:#f92672">.</span>unstack()
df_table<span style="color:#f92672">.</span>shape</code></pre></div>
<pre><code>(9724, 1220)
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_table<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">808</span>:<span style="color:#ae81ff">817</span>, <span style="color:#ae81ff">212</span>:<span style="color:#ae81ff">222</span>]<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#34;&#34;</span>)</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="10" halign="left">rating</th>
    </tr>
    <tr>
      <th>userId</th>
      <th>213</th>
      <th>214</th>
      <th>215</th>
      <th>216</th>
      <th>217</th>
      <th>218</th>
      <th>219</th>
      <th>220</th>
      <th>221</th>
      <th>222</th>
    </tr>
    <tr>
      <th>movieId</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1057</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1059</td>
      <td></td>
      <td>4</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td>2</td>
    </tr>
    <tr>
      <td>1060</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1061</td>
      <td></td>
      <td></td>
      <td>3.5</td>
      <td></td>
      <td>3</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1064</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1066</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1068</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1073</td>
      <td></td>
      <td>3</td>
      <td></td>
      <td></td>
      <td>3</td>
      <td></td>
      <td>2.5</td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>1077</td>
      <td></td>
      <td></td>
      <td></td>
      <td>3</td>
      <td>2</td>
      <td></td>
      <td></td>
      <td></td>
      <td>4</td>
      <td></td>
    </tr>
  </tbody>
</table>
</div>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë¹µê¾¸ê°€ ë§ì´ ë³´ì¸ë‹¤&hellip;<br />
ë³„ì ì´ ë¹„ì–´ ìˆëŠ” ë¹µê¾¸ë‚œ ë¶€ë¶„ì„<br />
ìš°ë¦¬ê°€ ë§Œë“¤ ëª¨ë¸ì„ í†µí•´ì„œ<br />
ë³„ì ì„ ì˜ˆì¸¡í•´ì„œ ì±„ì›Œ ë„£ì–´ì•¼ í•œë‹¤.</p>

<p>ì–´ë–»ê²Œ?</p>
</blockquote>

<h2 id="ë¯¸ë‹ˆ-ë°ì´í„°-mini-data">ë¯¸ë‹ˆ ë°ì´í„° (Mini Data)</h2>

<p>ë°ì´í„°ê°€ í¬ê³  ë¶ˆì™„ì „í•˜ë©´ ì´í•´í•˜ê¸°ë„ ì–´ë µê³  ë‹¤ë£¨ê¸°ë„ ì–´ë µë‹¤.<br />
ë¯¸ë‹ˆ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì„œ ì†”ë£¨ì…˜ì„ ì°¾ì•„ë³´ì!</p>

<p>5í¸ì˜ ì˜í™”ì— ëŒ€í•´ì„œ 4ëª…ì´ ë³„ì ì„ ë§¤ê¸´ ë°ì´í„°ê°€ ìˆë‹¤.</p>

<table>
<thead>
<tr>
<th>ì˜í™” \ ì‚¬ìš©ì</th>
<th>Alice</th>
<th>Bob</th>
<th>Carol</th>
<th>Dave</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>ë·°í‹°ì¸ì‚¬ì´ë“œ</strong></td>
<td>5</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td><strong>ë¼ë¼ëœë“œ</strong></td>
<td>5</td>
<td>4</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td><strong>ëŸ¬ë¸ŒìŠ¤í† ë¦¬</strong></td>
<td>5</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>

<tr>
<td><strong>ë§¤íŠ¸ë¦­ìŠ¤</strong></td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>5</td>
</tr>

<tr>
<td><strong>ìŠ¤íƒ€ì›Œì¦ˆ</strong></td>
<td>1</td>
<td>1</td>
<td>5</td>
<td>4</td>
</tr>
</tbody>
</table>

<p>ìš°ë¦¬ëŠ” ì—¬ê¸°ì„œ ì•¨ë¦¬ìŠ¤(Alice), ë°¥(Bob), ìºë¡¤(Carol), ë°ì´ë¸Œ(Dave)ë¥¼ ë¶„ë¥˜í•  ìˆ˜ ìˆëŠ” íŠ¹ì§•ê³¼<br />
ë·°í‹° ì¸ì‚¬ì´ë“œ, ë¼ë¼ëœë“œ, ëŸ¬ë¸Œ ìŠ¤í† ë¦¬, ë§¤íŠ¸ë¦­ìŠ¤, ìŠ¤íƒ€ì›Œì¦ˆë¥¼ ë¶„ë¥˜ í•  ìˆ˜ ìˆëŠ” íŠ¹ì§•ì„ ë°œê²¬í•  ê²ƒì´ë‹¤.</p>

<p>ì˜í™”ë¥¼ ë³´ì<br />
ë·°í‹° ì¸ì‚¬ì´ë“œ, ë¼ë¼ëœë“œ, ëŸ¬ë¸Œ ìŠ¤í† ë¦¬ëŠ” &lsquo;ë¡œë§¨í‹± ì˜í™”&rsquo;ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆê³ ,<br />
ë§¤íŠ¸ë¦­ìŠ¤ì™€ ìŠ¤íƒ€ì›Œì¦ˆëŠ” &lsquo;ê³µìƒê³¼í•™ ì˜í™”&rsquo;ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.</p>

<table>
<thead>
<tr>
<th>ì˜í™” \ íŠ¹ì§•</th>
<th>ë¡œë§¨í‹± ì˜í™”</th>
<th>ê³µìƒê³¼í•™ ì˜í™”</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>ë·°í‹°ì¸ì‚¬ì´ë“œ</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ë¼ë¼ëœë“œ</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ëŸ¬ë¸ŒìŠ¤í† ë¦¬</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ë§¤íŠ¸ë¦­ìŠ¤</strong></td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ìŠ¤íƒ€ì›Œì¦ˆ</strong></td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
</tr>
</tbody>
</table>

<p>ì‚¬ìš©ìë¥¼ ë³´ì<br />
ì•¨ë¦¬ìŠ¤ì™€ ë°¥ì€ ë¡œë§¨í‹± ì˜í™”ë¥¼ ì¢‹ì•„í•˜ê³  ê³µìƒê³¼í•™ ì˜í™”ë¥¼ ì¢‹ì•„í•˜ì§€ ì•ŠëŠ” &lsquo;ë¡œë§¨í‹±í•œ ì‚¬ëŒ&rsquo;ìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆê³ ,<br />
ìºë¡¤ê³¼ ë°ì´ë¸ŒëŠ” ê³µìƒê³¼í•™ ì˜í™”ë¥¼ ì¢‹ì•„í•˜ê³  ë¡œë§¨í‹± ì˜í™”ë¥¼ ì¢‹ì•„í•˜ì§€ ì•ŠëŠ” &lsquo;ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ&rsquo;ìœ¼ë¡œ ë¶„ë¥˜í•  ìˆ˜ ìˆë‹¤.</p>

<table>
<thead>
<tr>
<th>íŠ¹ì§• \ ì‚¬ìš©ì</th>
<th>Alice</th>
<th>Bob</th>
<th>Carol</th>
<th>Dave</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>ë¡œë§¨í‹±í•œ ì‚¬ëŒ</strong></td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
</tr>

<tr>
<td><strong>ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ</strong></td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë‚®ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
<td>ë†’ì€ ì ìˆ˜</td>
</tr>
</tbody>
</table>

<h3 id="ì ì¬-ì¸ìˆ˜-latent-factor">ì ì¬ ì¸ìˆ˜ (Latent factor)</h3>

<p>&lsquo;ë¡œë§¨í‹± ì˜í™”&rsquo;, &lsquo;ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ&rsquo;ê³¼ ê°™ì€ í”¼ì³(feature)ëŠ” ë°ì´í„°ì—ì„œëŠ” ë³´ì´ì§€ ì•ŠëŠ”ë‹¤.<br />
ì´ì™€ê°™ì´ ë°ì´í„°ë“¤ ì†ì— ìˆ¨ì–´ìˆëŠ” íŠ¹ì§•ì„ <strong>ì ì¬ ì¸ìˆ˜(Latent factor)</strong> ë¼ê³  í•œë‹¤.</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì ì¬ ì¸ìˆ˜(Latent factor)ì˜ ê°’ë“¤ì´<br />
ì˜í™”ì˜ íŠ¹ì§•ì„ ë³´ì—¬ì£¼ê³ <br />
í‰ê°€ìì˜ íŠ¹ì§•ì„ ë³´ì—¬ ì£¼ë©´ì„œ<br />
ë³„ì ìˆ˜ê¹Œì§€ ë³´ì—¬ ì£¼ëŠ” ë°©ë²•ì´ ì—†ì„ê¹Œ?</p>

<p>ìˆë‹¤! ê·¸ê²ƒì€ ë°”ë¡œ&hellip;</p>
</blockquote>

<h3 id="í–‰ë ¬-ì¸ìˆ˜-ë¶„í•´-matrix-factorization">í–‰ë ¬ ì¸ìˆ˜ ë¶„í•´ (Matrix Factorization)</h3>

<p>ë³„ì  ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ \(R\)ë¼ê³  í•˜ì</p>

<p>\(R= \begin{bmatrix}
5 &amp; 5 &amp; 1 &amp; 1  \\
5 &amp; 4 &amp; 1 &amp; 1  \\
5 &amp; 5 &amp; 1 &amp; 1  \\
1 &amp; 1 &amp; 5 &amp; 5  \\
1 &amp; 1 &amp; 5 &amp; 4
\end{bmatrix}\)</p>

<p>ìš°ë¦¬ëŠ” ì´ì œ \(R\) (5X4) ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ \(Q\) (5X2)ì™€ \(P^T\) (2X4) ë§¤íŠ¸ë¦­ìŠ¤ë¡œ ë¶„í•´ë¥¼ í•  ê²ƒì´ë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Non-negative matrix factorization</span>
<span style="color:#f92672">from</span> sklearn.decomposition <span style="color:#f92672">import</span> NMF
R <span style="color:#f92672">=</span> [
     [<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>],
     [<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>],
     [<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>],
     [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">5</span>],
     [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">4</span>],
    ]

k <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># number of factors</span>
model <span style="color:#f92672">=</span> NMF(n_components<span style="color:#f92672">=</span>k)
Q <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit_transform(np<span style="color:#f92672">.</span>array(R))
P <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>components_</code></pre></div>
<p>ì•„ë˜ \(Q\) ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë³´ì.</p>

<p>0ë²ˆ ì»¬ëŸ¼(Column)ì„ &lsquo;ë¡œë§¨í‹± ì˜í™”&rsquo;,<br />
1ë²ˆ ì»¬ëŸ¼(Column)ì„ &lsquo;ê³µìƒê³¼í•™ ì˜í™”&rsquo; ë¼ê³  í•˜ë©´<br />
\(Q\) ë§¤íŠ¸ë¦­ìŠ¤ëŠ” ì˜í™”ì˜ íŠ¹ì§•ì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Q (5X2) ë§¤íŠ¸ë¦­ìŠ¤</span>
pd<span style="color:#f92672">.</span>DataFrame(Q, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Romantic&#39;</span>, <span style="color:#e6db74">&#39;Sci-Fi&#39;</span>])</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Romantic</th>
      <th>Sci-Fi</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.931132</td>
      <td>0.000002</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1.744253</td>
      <td>0.047301</td>
    </tr>
    <tr>
      <td>2</td>
      <td>1.931132</td>
      <td>0.000002</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.376532</td>
      <td>2.425963</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.375488</td>
      <td>2.186905</td>
    </tr>
  </tbody>
</table>
</div>

<p>ì•„ë˜ \(P^T\) ë§¤íŠ¸ë¦­ìŠ¤ë¥¼ ë³´ì.</p>

<p>0ë²ˆ ì—´(Row)ì„ &lsquo;ë¡œë§¨í‹±í•œ ì‚¬ëŒ&rsquo;,<br />
1ë²ˆ ì—´(Row)ì„ &lsquo;ìƒìƒë ¥ì´ í’ë¶€í•œ ì‚¬ëŒ&rsquo; ì´ë¼ê³  í•˜ë©´<br />
\(P^T\) ë§¤íŠ¸ë¦­ìŠ¤ëŠ” ì‚¬ìš©ìì˜ íŠ¹ì§•ì„ ë‚˜íƒ€ë‚´ê³  ìˆë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># P (2X4) ë§¤íŠ¸ë¦­ìŠ¤</span>
pd<span style="color:#f92672">.</span>DataFrame(P, index<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Romantic Guy&#39;</span>, <span style="color:#e6db74">&#39;Imaginary Guy&#39;</span>])</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Romantic Guy</td>
      <td>2.669263</td>
      <td>2.503536</td>
      <td>0.518479</td>
      <td>0.518187</td>
    </tr>
    <tr>
      <td>Imaginary Guy</td>
      <td>0.000000</td>
      <td>0.023698</td>
      <td>2.077725</td>
      <td>1.872818</td>
    </tr>
  </tbody>
</table>
</div>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ \(Q\)ì™€ \(P^T\) ë§¤íŠ¸ë¦­ìŠ¤ê°€<br />
ë³„ì ì„ í‘œí˜„í•˜ëŠ” ì§€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ<br />
\(Q\)ì™€ \(P^T\)ë¥¼ ê³±í•´ ë³´ì</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">R_hat <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(Q,P)
pd<span style="color:#f92672">.</span>DataFrame(R_hat)</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>5.154699</td>
      <td>4.834659</td>
      <td>1.001255</td>
      <td>1.000692</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4.655871</td>
      <td>4.367922</td>
      <td>1.002637</td>
      <td>0.992436</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5.154699</td>
      <td>4.834659</td>
      <td>1.001255</td>
      <td>1.000692</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.005062</td>
      <td>1.000152</td>
      <td>5.235708</td>
      <td>4.738501</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.002276</td>
      <td>0.991874</td>
      <td>4.738469</td>
      <td>4.290248</td>
    </tr>
  </tbody>
</table>
</div>

<p>\(R\)ê³¼ ë¹„ìŠ·í•œ ê°’ì´ ë‚˜ì˜¨ë‹¤.</p>

<p>ì´ë ‡ê²Œ  \(R \simeq Q \cdot P^T\) ë¥¼ <strong>í–‰ë ¬ì¸ìˆ˜ë¶„í•´(Matrix Factorization)</strong> ë¼ê³  í•œë‹¤.</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë†€ëë‹¤!</p>

<p>í‰ê°€ìë“¤ì˜ ì˜í™” í‰ì  ë§¤íŠ¸ë¦­ìŠ¤ë§Œ ê°€ì§€ê³ <br />
í‰ê°€ìë“¤ì˜ ì ì¬ ì¸ìˆ˜(latent factor)ì™€<br />
ì˜í™”ì˜ ì ì¬ ì¸ìˆ˜(latent factor)ë¥¼<br />
ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤.</p>

<p>ìˆ˜í•™ì´ ì´ë ‡ê²Œ ì‹ ê¸°í•˜ê³ <br />
ì¬ë¯¸ìˆë‹¤ë‹ˆ&hellip;</p>

<p>í•™ìƒë•Œ<br />
ì—´ì‹¬íˆ í• ê±¸&hellip;</p>

<p>ê·¸ëŸ¬ë‚˜</p>

<p>ë³„ì ì´ ë¹µê¾¸ë‚œ ë°ì´í„°ì— ëŒ€í•´ì„œ<br />
ì ì¬ ì¸ìˆ˜(Latent factor)ë¥¼ ì–´ë–»ê²Œ ì°¾ì„ê¹Œ?</p>
</blockquote>

<h3 id="ì ì¬-ì¸ìˆ˜-ì°¾ê¸°">ì ì¬ ì¸ìˆ˜ ì°¾ê¸°</h3>

<p>ì•ì—ì„œ ë°°ìš´ ì„ í˜•íšŒê·€(Linear regression)ë¥¼ ê¸°ì–µí•´ ë³´ì</p>

<ol>
<li>\(\hat y=wx+b\)ë¥¼ ì •ì˜í•˜ê³ <br /></li>
<li>ì†ì‹¤í•¨ìˆ˜(Loss function) \(J(w,b)\)ë¥¼ ì •ì˜í•˜ê³ <br /></li>
<li>ê²½ì‚¬í•˜ê°•ë²•(Gradient descent)ìœ¼ë¡œ ì†ì‹¤ê°’ì´ ìµœì†Œê°€ ë˜ëŠ” \(w, b\)ë¥¼ ì°¾ì•˜ë‹¤.<br /></li>
</ol>

<p>ì´ê²ƒì„ ì ì¬ ì¸ìˆ˜ ì°¾ê¸°ì— í™œìš©í•´ ë³´ì</p>

<ol>
<li>\(\hat r=q \cdot p^T\)ë¥¼ ì •ì˜í•˜ê³ <br /></li>
<li>ì†ì‹¤í•¨ìˆ˜(Loss function) \(J(p,q)\)ë¥¼ ì •ì˜í•˜ê³ <br /></li>
<li>ê²½ì‚¬í•˜ê°•ë²•(Gradient descent)ìœ¼ë¡œ ì†ì‹¤ê°’ì´ ìµœì†Œê°€ ë˜ëŠ” \(p, q\)ë¥¼ ì°¾ìœ¼ë©´ ë˜ì§€ ì•Šì„ê¹Œ?<br /></li>
</ol>

<h3 id="kerasë¥¼-ì´ìš©í•œ-ë¯¸ë‹ˆ-ëª¨ë¸ë§">Kerasë¥¼ ì´ìš©í•œ ë¯¸ë‹ˆ ëª¨ë¸ë§</h3>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì¢‹ì•˜ì–´!</p>

<p>ë¯¸ë‹ˆ ë°ì´í„°ë¥¼ ê°€ì§€ê³  í™•ì¸ í•´ë³´ì</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

data <span style="color:#f92672">=</span> [
    [<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;Beauty Inside&#39;</span>, <span style="color:#ae81ff">5</span>],
    [<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;La La Land&#39;</span>, <span style="color:#ae81ff">5</span>],
    [<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;Love Story&#39;</span>, <span style="color:#ae81ff">5</span>],
    [<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;Matrix&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#e6db74">&#39;Star Wars&#39;</span>, <span style="color:#ae81ff">1</span>], 
    [<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#e6db74">&#39;La La Land&#39;</span>, <span style="color:#ae81ff">4</span>],
    [<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#e6db74">&#39;Love Story&#39;</span>, <span style="color:#ae81ff">5</span>],
    [<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#e6db74">&#39;Matrix&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#e6db74">&#39;Star Wars&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Carol&#39;</span>, <span style="color:#e6db74">&#39;Beauty Inside&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Carol&#39;</span>, <span style="color:#e6db74">&#39;La La Land&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Carol&#39;</span>, <span style="color:#e6db74">&#39;Matrix&#39;</span>, <span style="color:#ae81ff">5</span>],
    [<span style="color:#e6db74">&#39;Carol&#39;</span>, <span style="color:#e6db74">&#39;Star Wars&#39;</span>, <span style="color:#ae81ff">5</span>], 
    [<span style="color:#e6db74">&#39;Dave&#39;</span>, <span style="color:#e6db74">&#39;Beauty Inside&#39;</span>, <span style="color:#ae81ff">1</span>], 
    [<span style="color:#e6db74">&#39;Dave&#39;</span>, <span style="color:#e6db74">&#39;La La Land&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Dave&#39;</span>, <span style="color:#e6db74">&#39;Love Story&#39;</span>, <span style="color:#ae81ff">1</span>],
    [<span style="color:#e6db74">&#39;Dave&#39;</span>, <span style="color:#e6db74">&#39;Matrix&#39;</span>, <span style="color:#ae81ff">5</span>],
    [<span style="color:#e6db74">&#39;Dave&#39;</span>, <span style="color:#e6db74">&#39;Star Wars&#39;</span>, <span style="color:#ae81ff">4</span>],
]

mini_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame( data <span style="color:#f92672">=</span> data, columns <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;user&#39;</span>, <span style="color:#e6db74">&#39;item&#39;</span>, <span style="color:#e6db74">&#39;rating&#39;</span>])
mini_df</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>Alice</td>
      <td>Beauty Inside</td>
      <td>5</td>
    </tr>
    <tr>
      <td>1</td>
      <td>Alice</td>
      <td>La La Land</td>
      <td>5</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Alice</td>
      <td>Love Story</td>
      <td>5</td>
    </tr>
    <tr>
      <td>3</td>
      <td>Alice</td>
      <td>Matrix</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>Alice</td>
      <td>Star Wars</td>
      <td>1</td>
    </tr>
    <tr>
      <td>5</td>
      <td>Bob</td>
      <td>La La Land</td>
      <td>4</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Bob</td>
      <td>Love Story</td>
      <td>5</td>
    </tr>
    <tr>
      <td>7</td>
      <td>Bob</td>
      <td>Matrix</td>
      <td>1</td>
    </tr>
    <tr>
      <td>8</td>
      <td>Bob</td>
      <td>Star Wars</td>
      <td>1</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Carol</td>
      <td>Beauty Inside</td>
      <td>1</td>
    </tr>
    <tr>
      <td>10</td>
      <td>Carol</td>
      <td>La La Land</td>
      <td>1</td>
    </tr>
    <tr>
      <td>11</td>
      <td>Carol</td>
      <td>Matrix</td>
      <td>5</td>
    </tr>
    <tr>
      <td>12</td>
      <td>Carol</td>
      <td>Star Wars</td>
      <td>5</td>
    </tr>
    <tr>
      <td>13</td>
      <td>Dave</td>
      <td>Beauty Inside</td>
      <td>1</td>
    </tr>
    <tr>
      <td>14</td>
      <td>Dave</td>
      <td>La La Land</td>
      <td>1</td>
    </tr>
    <tr>
      <td>15</td>
      <td>Dave</td>
      <td>Love Story</td>
      <td>1</td>
    </tr>
    <tr>
      <td>16</td>
      <td>Dave</td>
      <td>Matrix</td>
      <td>5</td>
    </tr>
    <tr>
      <td>17</td>
      <td>Dave</td>
      <td>Star Wars</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<p>ì˜í™” ì œëª©ì„ ì—´(Row)ë¡œ í•˜ê³  ì‚¬ìš©ì ì´ë¦„ì„ ì»¬ëŸ¼(Column)ìœ¼ë¡œ í…Œì´ë¸”ì„ ë§Œë“¤ì</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_table <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>pivot_table(mini_df, values<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rating&#39;</span>, index<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;item&#39;</span>, columns<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;user&#39;</span>, fill_value<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
df_table</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>user</th>
      <th>Alice</th>
      <th>Bob</th>
      <th>Carol</th>
      <th>Dave</th>
    </tr>
    <tr>
      <th>item</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Beauty Inside</td>
      <td>5.0</td>
      <td></td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>La La Land</td>
      <td>5.0</td>
      <td>4</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>Love Story</td>
      <td>5.0</td>
      <td>5</td>
      <td></td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>Matrix</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>Star Wars</td>
      <td>1.0</td>
      <td>1</td>
      <td>5</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div>

<h4 id="ë°ì´í„°-ë³€í™˜-data-transformation">ë°ì´í„° ë³€í™˜ (Data Transformation)</h4>

<p>ì‚¬ìš©ì ì´ë¦„ê³¼ ì˜í™” ì œëª©ì€ Kerasê°€ ì…ë ¥ì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ìˆ«ìë¡œ ë³€í™˜ì´ ë˜ì–´ì•¼ í•œë‹¤.<br />
ì‚¬ìš©ì(<code>user</code>)ë¥¼ ìˆ«ìë¡œ ë³€í™˜í•´ ë³´ì</p>

<p>Aliceê°€ 0ë²ˆ, Bobì´ 1ë²ˆ, Carolì´ 2ë²ˆ, Daveê°€ 3ë²ˆìœ¼ë¡œ ë³€í™˜ ë˜ì—ˆë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mini_df<span style="color:#f92672">.</span>user <span style="color:#f92672">=</span> mini_df<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>codes<span style="color:#f92672">.</span>values
mini_df</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>Beauty Inside</td>
      <td>5</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td>La La Land</td>
      <td>5</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>Love Story</td>
      <td>5</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0</td>
      <td>Matrix</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>Star Wars</td>
      <td>1</td>
    </tr>
    <tr>
      <td>5</td>
      <td>1</td>
      <td>La La Land</td>
      <td>4</td>
    </tr>
    <tr>
      <td>6</td>
      <td>1</td>
      <td>Love Story</td>
      <td>5</td>
    </tr>
    <tr>
      <td>7</td>
      <td>1</td>
      <td>Matrix</td>
      <td>1</td>
    </tr>
    <tr>
      <td>8</td>
      <td>1</td>
      <td>Star Wars</td>
      <td>1</td>
    </tr>
    <tr>
      <td>9</td>
      <td>2</td>
      <td>Beauty Inside</td>
      <td>1</td>
    </tr>
    <tr>
      <td>10</td>
      <td>2</td>
      <td>La La Land</td>
      <td>1</td>
    </tr>
    <tr>
      <td>11</td>
      <td>2</td>
      <td>Matrix</td>
      <td>5</td>
    </tr>
    <tr>
      <td>12</td>
      <td>2</td>
      <td>Star Wars</td>
      <td>5</td>
    </tr>
    <tr>
      <td>13</td>
      <td>3</td>
      <td>Beauty Inside</td>
      <td>1</td>
    </tr>
    <tr>
      <td>14</td>
      <td>3</td>
      <td>La La Land</td>
      <td>1</td>
    </tr>
    <tr>
      <td>15</td>
      <td>3</td>
      <td>Love Story</td>
      <td>1</td>
    </tr>
    <tr>
      <td>16</td>
      <td>3</td>
      <td>Matrix</td>
      <td>5</td>
    </tr>
    <tr>
      <td>17</td>
      <td>3</td>
      <td>Star Wars</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<p>ì˜í™” ì œëª©(<code>item</code>)ì„ ìˆ«ìë¡œ ë³€í™˜í•œë‹¤.<br />
ë·°í‹°ì¸ì‚¬ì´ë“œê°€ 0, ë¼ë¼ëœë“œê°€ 1, ëŸ¬ë¸ŒìŠ¤í† ë¦¬ê°€ 2, ë§¤íŠ¸ë¦­ìŠ¤ê°€ 3, ìŠ¤íƒ€ì›Œì¦ˆ 4ë¡œ ë³€í™˜ëœ ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">mini_df<span style="color:#f92672">.</span>item <span style="color:#f92672">=</span> mini_df<span style="color:#f92672">.</span>item<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>codes<span style="color:#f92672">.</span>values
mini_df</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <td>5</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <td>6</td>
      <td>1</td>
      <td>2</td>
      <td>5</td>
    </tr>
    <tr>
      <td>7</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <td>8</td>
      <td>1</td>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <td>9</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>10</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>11</td>
      <td>2</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <td>12</td>
      <td>2</td>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <td>13</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>14</td>
      <td>3</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>15</td>
      <td>3</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <td>16</td>
      <td>3</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <td>17</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.keras <span style="color:#f92672">import</span> Model
<span style="color:#f92672">from</span> tensorflow.keras.layers <span style="color:#f92672">import</span> Input, Embedding, Flatten, dot
<span style="color:#f92672">from</span> tensorflow.keras <span style="color:#f92672">import</span> regularizers

item_input <span style="color:#f92672">=</span> Input(shape<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>]) <span style="color:#75715e"># mini_df.item</span>
user_input <span style="color:#f92672">=</span> Input(shape<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>]) <span style="color:#75715e"># mini_df.user</span></code></pre></div>
<h4 id="ì„ë² ë”©-embedding">ì„ë² ë”© (Embedding)</h4>

<p>ì ì¬ ì¸ìˆ˜(Latent factor)ì˜ ëª¨ì–‘(Shape)ë¥¼ ì •ì˜í•˜ê³  ëª¨ë¸ì— ì‚½ì…í•˜ëŠ” ê²ƒì„ <strong>ì„ë² ë”©(Embedding)</strong> ì´ë¼ê³  í•œë‹¤.<br />
ì„ë² ë”©(Embedding)ëœ ê°’ë“¤ì€ ëª¨ë¸ì´ í›ˆë ¨ë˜ë©´ì„œ í•™ìŠµì´ ëœë‹¤. ë‹¤ì‹œ ë§í•˜ë©´ ì†ì‹¤í•¨ìˆ˜(Loss function)ê°€ ìµœì €ê°’ì„ ì°¾ì•„ê°€ëŠ” ê³¼ì •ì—ì„œ ìµœì ì˜ ê°’ìœ¼ë¡œ ìë™ìœ¼ë¡œ ì„¸íŒ…ëœë‹¤.<br />
ì˜í™”(<code>item</code>)ì— ëŒ€í•œ ì ì¬ ì¸ìˆ˜ì˜ ëª¨ì–‘(Shape)ì„ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•˜ì.</p>

<ul>
<li>ì—´(Row)ì˜ ê¸¸ì´ëŠ” ì˜í™”ì˜ ê°œìˆ˜</li>
<li>ì»¬ëŸ¼(Column)ì˜ ê¸¸ì´ëŠ” ì ì¬ ì¸ìˆ˜ì˜ ê°œìˆ˜</li>
</ul>

<p>\(Q = \begin{bmatrix}
q_{00} &amp; q_{01} \\
q_{10} &amp; q_{11} \\
q_{20} &amp; q_{21} \\
q_{30} &amp; q_{31} \\
q_{40} &amp; q_{41}
\end{bmatrix} \)</p>

<p>ì‚¬ìš©ì(<code>user</code>)ì— ëŒ€í•œ ì ì¬ ì¸ìˆ˜ì˜ ëª¨ì–‘(Shape)ì„ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•˜ì.</p>

<ul>
<li>ì—´(Row)ì˜ ê¸¸ì´ëŠ” ì‚¬ìš©ìì˜ ìˆ˜</li>
<li>ì»¬ëŸ¼(Column)ì˜ ê¸¸ì´ëŠ” ì ì¬ ì¸ìˆ˜ì˜ ê°œìˆ˜</li>
</ul>

<p>\(P = \begin{bmatrix}
p_{00} &amp; p_{01} \\
p_{10} &amp; p_{11} \\
p_{20} &amp; p_{21} \\
p_{30} &amp; p_{31}
\end{bmatrix} \)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">n_items <span style="color:#f92672">=</span> len(mini_df<span style="color:#f92672">.</span>item<span style="color:#f92672">.</span>unique()) <span style="color:#75715e"># ì˜í™” 5í¸</span>
n_items_latent_factors <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># ì˜í™”ì˜ ì ì¬ ì¸ìˆ˜ ê°œìˆ˜</span>

n_users <span style="color:#f92672">=</span> len(mini_df<span style="color:#f92672">.</span>user<span style="color:#f92672">.</span>unique()) <span style="color:#75715e"># ì‚¬ìš©ì 4ëª… </span>
n_users_latent_factors <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># ì‚¬ìš©ìì˜ ì ì¬ ì¸ìˆ˜ ê°œìˆ˜</span>

<span style="color:#75715e"># Item latent factor</span>
item_embedding <span style="color:#f92672">=</span> Embedding(n_items, n_items_latent_factors, <span style="color:#75715e"># (5X2) Latent factor</span>
                           embeddings_regularizer<span style="color:#f92672">=</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.001</span>),
                           name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;item_embedding&#39;</span>)(item_input)
<span style="color:#75715e"># User latent factor</span>
user_embedding <span style="color:#f92672">=</span> Embedding(n_users, n_users_latent_factors, <span style="color:#75715e"># (4X2) Latent factor</span>
                           embeddings_regularizer<span style="color:#f92672">=</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.001</span>),
                           name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;user_embedding&#39;</span>)(user_input)</code></pre></div>
<pre><code>WARNING: Logging before flag parsing goes to stderr.
W0914 23:06:25.672605 139764579673920 deprecation.py:506] From /home/dataman/anaconda3/lib/python3.7/site-packages/tensorflow/python/keras/initializers.py:119: calling RandomUniform.__init__ (from tensorflow.python.ops.init_ops) with dtype is deprecated and will be removed in a future version.
Instructions for updating:
Call initializer instance with the dtype argument instead of passing it to the constructor
</code></pre>

<h4 id="ë²¡í„°í™”-flattern">ë²¡í„°í™” (Flattern)</h4>

<p>2Dë¡œ ë˜ì–´ ìˆëŠ” ì„ë² ë”©(Embedding)ì„ 1Dë¡œ ë³€í™˜í•œë‹¤.  ì´ê²ƒì„ <strong>ì ì¬ ë²¡í„°(Latent vector)</strong> ë¼ê³  í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Item latent vector</span>
item_vec <span style="color:#f92672">=</span> Flatten()(item_embedding)
<span style="color:#75715e"># User latent vector</span>
user_vec <span style="color:#f92672">=</span> Flatten()(user_embedding)</code></pre></div>
<h4 id="ë¯¸ë‹ˆ-ëª¨ë¸ë§-modeling">ë¯¸ë‹ˆ ëª¨ë¸ë§ (Modeling)</h4>

<ul>
<li>\(\hat R = Q \cdot P^T\)</li>
</ul>

<p>ì†ì‹¤ í•¨ìˆ˜(Loss function)ëŠ” í‰ê·  ì œê³± ì˜¤ì°¨(mean-squared error)ë¥¼ ì‚¬ìš©í•œë‹¤.<br />
ìµœì í™”(Optimizer)ëŠ” ê²½ì‚¬í•˜ê°•ë²•(gradient descent)ì„ ì‚¬ìš©í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">r_hat <span style="color:#f92672">=</span> dot([item_vec, user_vec], axes<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
mini_model <span style="color:#f92672">=</span> Model([user_input, item_input], r_hat)
mini_model<span style="color:#f92672">.</span>compile(optimizer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;sgd&#39;</span>, loss <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mean_squared_error&#39;</span>)</code></pre></div>
<h4 id="ë¯¸ë‹ˆ-ëª¨ë¸-í›ˆë ¨-train-model">ë¯¸ë‹ˆ ëª¨ë¸ í›ˆë ¨ (Train Model)</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">hist <span style="color:#f92672">=</span> mini_model<span style="color:#f92672">.</span>fit([mini_df<span style="color:#f92672">.</span>user, mini_df<span style="color:#f92672">.</span>item], mini_df<span style="color:#f92672">.</span>rating, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">2000</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>) 
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;loss: &#39;</span>, hist<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;loss&#39;</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

<span style="color:#f92672">%</span>matplotlib inline
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt

plt<span style="color:#f92672">.</span>plot(hist<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;loss&#39;</span>])
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;epoch&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;loss&#39;</span>)
plt<span style="color:#f92672">.</span>show()</code></pre></div>
<pre><code>loss:  0.07310417294502258
</code></pre>

<p><img src="output_50_1.png" alt="png" /></p>

<h4 id="ë¯¸ë‹ˆ-ì˜ˆì¸¡-predict">ë¯¸ë‹ˆ ì˜ˆì¸¡ (Predict)</h4>

<p>ì´ì œ ë¹µê¾¸ë‚œ ë³„ì ì„ ì˜ˆì¸¡í•´ ë³´ì</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Q <span style="color:#f92672">=</span> mini_model<span style="color:#f92672">.</span>get_layer(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;item_embedding&#39;</span>)<span style="color:#f92672">.</span>get_weights()[<span style="color:#ae81ff">0</span>]
P <span style="color:#f92672">=</span> mini_model<span style="color:#f92672">.</span>get_layer(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;user_embedding&#39;</span>)<span style="color:#f92672">.</span>get_weights()[<span style="color:#ae81ff">0</span>]
P_t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>transpose(P)

R_hat <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>dot(Q, P_t)
pd<span style="color:#f92672">.</span>DataFrame(R_hat)</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.986020</td>
      <td>4.506338</td>
      <td>1.004396</td>
      <td>0.993599</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4.735092</td>
      <td>4.280501</td>
      <td>1.003393</td>
      <td>0.988274</td>
    </tr>
    <tr>
      <td>2</td>
      <td>5.230458</td>
      <td>4.726562</td>
      <td>1.017328</td>
      <td>1.009568</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1.002702</td>
      <td>1.002625</td>
      <td>5.225470</td>
      <td>4.729930</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1.001995</td>
      <td>0.992466</td>
      <td>4.729147</td>
      <td>4.282340</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;ë·°í‹° ì¸ì‚¬ì´ë“œì— ëŒ€í•œ Bobì˜ ì˜ˆìƒ ë³„ì ì€ {:.1f}&#39;</span><span style="color:#f92672">.</span>format(R_hat[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>]))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;ëŸ¬ë¸Œ ìŠ¤í† ë¦¬ì— ëŒ€í•œ Carolì˜ ì˜ˆìƒ ë³„ì ì€ {:.1f} ì´ë‹¤.&#39;</span><span style="color:#f92672">.</span>format(R_hat[<span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">2</span>]))</code></pre></div>
<pre><code>ë·°í‹° ì¸ì‚¬ì´ë“œì— ëŒ€í•œ Bobì˜ ì˜ˆìƒ ë³„ì ì€ 4.5
ëŸ¬ë¸Œ ìŠ¤í† ë¦¬ì— ëŒ€í•œ Carolì˜ ì˜ˆìƒ ë³„ì ì€ 1.0 ì´ë‹¤.
</code></pre>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì‹¤ì œ ê°’ê³¼ ê°€ê¹ê²Œ ì˜ˆì¸¡ì„ í•˜ê³  ìˆë‹¤!</p>
</blockquote>

<h2 id="ì ì¬-ì¸ìˆ˜-ëª¨ë¸ë§-latent-factor-modeling">ì ì¬ ì¸ìˆ˜ ëª¨ë¸ë§ (Latent Factor Modeling)</h2>

<p>ì•Œê³  ìˆëŠ” ë°ì´í„°ì„¸íŠ¸(\(X, Y\))ë¥¼ í•™ìŠµí•˜ì—¬ ìƒˆë¡œìš´ ì…ë ¥ê°’(\(X_{new}\))ì— ëŒ€í•´ ì¶œë ¥ê°’(\(\hat Y\))ì„ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ì´ ì„ í˜• íšŒê·€ ëª¨ë¸ì´ë‹¤. ì ì¬ ì¸ìˆ˜ ëª¨ë¸ë„ ì„ í˜• íšŒê·€ ëª¨ë¸ê³¼ ë¹„ìŠ·í•˜ê²Œ ì†ì‹¤í•¨ìˆ˜ë¥¼ ì •ì˜í•˜ê³  ì†ì‹¤í•¨ìˆ˜ê°€ ìµœì†Œê°€ ë˜ëŠ” \(P\)ì™€ \(Q\)ë¥¼ ì°¾ëŠ” ëª¨ë¸ì´ë‹¤.</p>

<h3 id="ì†ì‹¤í•¨ìˆ˜-loss-function">ì†ì‹¤í•¨ìˆ˜ (Loss function)</h3>

<p>ì ì¬ ì¸ìˆ˜ ëª¨ë¸(Latent factor model)ì—ì„œì˜ ì†ì‹¤ í•¨ìˆ˜(Loss function)ëŠ” <strong>SSE(Sum of Squared Error)</strong> ë¥¼ ì‚¬ìš©í•œë‹¤.</p>

<p>\(J(p, q) = {1 \over 2}\sum_{(i,j) \in R} (r_{ij} - q_i \cdot p_{j}^T)^2\)</p>

<p>ì—¬ê¸°ì— ê³¼ëŒ€ì í•©(Overfitting)ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ <strong>L2 Regularization</strong> ì„ ì¶”ê°€í•œë‹¤.</p>

<p>\(\begin{align}
J(p, q) &amp; = {1 \over 2}\sum_{(i,j) \in R} (r_{ij} - q_i \cdot p_{j}^T)^2 \\
 &amp; + {1 \over 2}\lambda \sum_{i} ||q_i||^2 + {1 \over 2}\lambda \sum_{j} ||p_j||^2
\end{align}\)</p>

<h3 id="ìµœì í™”-optimization">ìµœì í™” (Optimization)</h3>

<p>ì†ì‹¤í•¨ìˆ˜ì˜ ìµœì†Œê°’ì„ ì°¾ê¸° ìœ„í•´ì„œ <strong>ê²½ì‚¬ í•˜ê°•ë²•(Gradient Descent)</strong> ì„ ì ìš©í•œë‹¤.</p>

<p>REPEAT(epoch) {</p>

<p>\(\begin{align}
p: &amp;= p-\alpha \dfrac{\partial J(p,q)}{\partial p} \\
q: &amp;= q-\alpha \dfrac{\partial J(p,q)}{\partial q}
\end{align}\)<br />
}</p>

<p>\(\alpha\): learining rate</p>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ì—¬ê¸°ì„œëŠ”<br />
SSE ëŒ€ì‹ ì— MSEë¥¼<br />
GD ëŒ€ì‹ ì— Adamì„ ì‚¬ìš©í•œë‹¤.</p>
</blockquote>

<h3 id="ì •ë¦¬">ì •ë¦¬</h3>

<p>ì ì¬ ì¸ìˆ˜ ëª¨ë¸ (Latent factor model)ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ì •ë¦¬í•´ ë³´ì.</p>

<ol>
<li>Item, User ê°’ì„ ì¸ë±ìŠ¤ ê°’ìœ¼ë¡œ ë³€í™˜í•œë‹¤.<br /></li>
<li>ì ì¬ ì¸ìˆ˜(Latent factor)ì˜ ê°œìˆ˜ë¥¼ ì •í•œë‹¤.<br /></li>
<li>ì ì¬ ì¸ìˆ˜(Latent factor)ë¥¼ <strong>ì„ë² ë”©(Embedding)</strong> í•œë‹¤.<br /></li>
<li><strong>ë²¡í„°í™”(Flatten)</strong> í•´ì„œ ì ì¬ ë²¡í„°(Latent vector)ë¡œ ë³€í™˜í•œë‹¤.<br /></li>
<li>\(\hat R\)ë¥¼ Itemê³¼ Userì˜ ì ì¬ ë²¡í„°ì˜ <strong>ë‚´ì (dot)</strong> ìœ¼ë¡œ ì„¤ì •í•œë‹¤.<br /></li>
<li>ì†ì‹¤ í•¨ìˆ˜ (Loss function)ë¥¼ ì •ì˜í•œë‹¤. ì—¬ê¸°ì„œëŠ” <strong>í‰ê·  ì œê³± ì˜¤ì°¨(mean squared error)</strong> ë¥¼ ì‚¬ìš©í•œë‹¤.<br /></li>
<li>ì˜µí‹°ë§ˆì´ì €(Optimizer)ë¥¼ ì •ì˜í•œë‹¤. ì—¬ê¸°ì„œëŠ” <strong>Adam</strong> ì„ ì‚¬ìš©í•œë‹¤.<br /></li>
<li>ë°˜ë³µí•  íšŒìˆ˜(epoch)ë¥¼ ê²°ì •í•œë‹¤.<br /></li>
<li>ì£¼ì–´ì§„ ì¡°ê±´ìœ¼ë¡œ ëª¨ë¸ì„ ìµœì í™”(fit) ì‹œí‚¨ë‹¤.<br /></li>
</ol>

<h2 id="ì¼€ë¼ìŠ¤-keras-ë¡œ-ëª¨ë¸ë§-modeling">ì¼€ë¼ìŠ¤(Keras)ë¡œ ëª¨ë¸ë§(Modeling)</h2>

<h3 id="ë°ì´í„°-ë³€í™˜">ë°ì´í„° ë³€í™˜</h3>

<p><code>userId</code>ì™€ <code>movieId</code>ë¥¼ ìˆ«ìë¡œ ë³€í™˜(ì¸ì½”ë”©)í•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Indexing userId and movieId</span>
users <span style="color:#f92672">=</span> ratings_df<span style="color:#f92672">.</span>userId<span style="color:#f92672">.</span>unique()
movies <span style="color:#f92672">=</span> ratings_df<span style="color:#f92672">.</span>movieId<span style="color:#f92672">.</span>unique()

userid2idx <span style="color:#f92672">=</span> {o:i <span style="color:#66d9ef">for</span> i,o <span style="color:#f92672">in</span> enumerate(users)}
movieid2idx <span style="color:#f92672">=</span> {o:i <span style="color:#66d9ef">for</span> i,o <span style="color:#f92672">in</span> enumerate(movies)}

ratings_df[<span style="color:#e6db74">&#39;userId&#39;</span>] <span style="color:#f92672">=</span> ratings_df[<span style="color:#e6db74">&#39;userId&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: userid2idx[x])
ratings_df[<span style="color:#e6db74">&#39;movieId&#39;</span>] <span style="color:#f92672">=</span> ratings_df[<span style="color:#e6db74">&#39;movieId&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: movieid2idx[x])</code></pre></div>
<h3 id="í›ˆë ¨-í…ŒìŠ¤íŠ¸-ë°ì´í„°-ë¶„í• ">í›ˆë ¨, í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¶„í• </h3>

<p>í›ˆë ¨ ë°ì´í„°ëŠ” <code>ratings_df</code>ì—ì„œ ëœë¤í•˜ê²Œ 80%ë¥¼ ì„ íƒí•˜ê³ ,<br />
í…ŒìŠ¤íŠ¸ ë°ì´í„°ëŠ” ë‚˜ë¨¸ì§€ 20%ë¥¼ ëœë¤í•˜ê²Œ ì„ íƒí•œë‹¤.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Split train and test data</span>
split <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand(len(ratings_df)) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0.8</span>

train_df <span style="color:#f92672">=</span> ratings_df[split]
test_df <span style="color:#f92672">=</span> ratings_df[<span style="color:#f92672">~</span>split]

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;shape of train data is &#39;</span>,train_df<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;shape of test data is &#39;</span>,test_df<span style="color:#f92672">.</span>shape)</code></pre></div>
<pre><code>shape of train data is  (80712, 4)
shape of test data is  (20124, 4)
</code></pre>

<h3 id="ì„ë² ë”©-embedding-1">ì„ë² ë”© (Embedding)</h3>

<p>ì ì¬ ì¸ìˆ˜ ê°œìˆ˜ë¥¼ 64ê°œë¡œ í•˜ì.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">n_movies <span style="color:#f92672">=</span> len(ratings_df<span style="color:#f92672">.</span>movieId<span style="color:#f92672">.</span>unique())
n_users <span style="color:#f92672">=</span> len(ratings_df<span style="color:#f92672">.</span>userId<span style="color:#f92672">.</span>unique())
n_latent_factors <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>

movie_input <span style="color:#f92672">=</span> Input(shape<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>])
<span style="color:#75715e"># Item latent factor</span>
movie_embedding <span style="color:#f92672">=</span> Embedding(n_movies, n_latent_factors,
                            embeddings_regularizer<span style="color:#f92672">=</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.00001</span>), 
                            name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;movie_embedding&#39;</span>)(movie_input)

user_input <span style="color:#f92672">=</span> Input(shape<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>])
<span style="color:#75715e"># User latent factor</span>
user_embedding <span style="color:#f92672">=</span> Embedding(n_users, n_latent_factors,
                           embeddings_regularizer<span style="color:#f92672">=</span>regularizers<span style="color:#f92672">.</span>l2(<span style="color:#ae81ff">0.00001</span>),
                           name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;user_embedding&#39;</span>)(user_input)</code></pre></div>
<h3 id="ë²¡í„°í™”-flatten">ë²¡í„°í™” (Flatten)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Item latent vector</span>
movie_vec <span style="color:#f92672">=</span> Flatten()(movie_embedding)
<span style="color:#75715e"># User latent vector</span>
user_vec <span style="color:#f92672">=</span> Flatten()(user_embedding)</code></pre></div>
<h3 id="ëª¨ë¸ë§-modeling">ëª¨ë¸ë§ (Modeling)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">r_hat <span style="color:#f92672">=</span> dot([movie_vec, user_vec], axes<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
model <span style="color:#f92672">=</span> Model([user_input, movie_input], r_hat)
model<span style="color:#f92672">.</span>compile(optimizer <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;adam&#39;</span>, loss <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mean_squared_error&#39;</span>)</code></pre></div>
<h3 id="ëª¨ë¸-í›ˆë ¨-train-model">ëª¨ë¸ í›ˆë ¨ (Train Model)</h3>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ëŒë ¤ë†“ê³  ì»¤í”¼ í•œì” í•˜ì„¸ì—¬~ â˜•ï¸</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">hist <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>fit([train_df<span style="color:#f92672">.</span>userId, train_df<span style="color:#f92672">.</span>movieId], train_df<span style="color:#f92672">.</span>rating, 
                 batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span>, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> ) 

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;train loss: &#39;</span>, hist<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;loss&#39;</span>][<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])

<span style="color:#f92672">%</span>matplotlib inline
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt

plt<span style="color:#f92672">.</span>plot(hist<span style="color:#f92672">.</span>history[<span style="color:#e6db74">&#39;loss&#39;</span>])
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;epoch&#39;</span>)
plt<span style="color:#f92672">.</span>ylabel(<span style="color:#e6db74">&#39;loss&#39;</span>)
plt<span style="color:#f92672">.</span>show()</code></pre></div>
<pre><code>train loss:  0.22794349201962194
</code></pre>

<p><img src="output_67_1.png" alt="png" /></p>

<h3 id="ëª¨ë¸-í‰ê°€-test-model">ëª¨ë¸ í‰ê°€ (Test Model)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">test_loss <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>evaluate([test_df<span style="color:#f92672">.</span>userId, test_df<span style="color:#f92672">.</span>movieId], test_df<span style="color:#f92672">.</span>rating)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;test loss: &#39;</span>, test_loss)</code></pre></div>
<pre><code>20124/20124 [==============================] - 1s 32us/sample - loss: 1.8129
test loss:  1.8128546826812435
</code></pre>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ìŒ&hellip;<br />
ê°œì„  ì‚¬í•­ì´ ë³´ì´ì§€ë§Œ<br />
ì˜¤ëŠ˜ì€ ì—¬ê¸°ê¹Œì§€ í•˜ì</p>
</blockquote>

<h2 id="í•´ê²°-solution">í•´ê²° (Solution)</h2>

<p>âš™ï¸ ì—”ì§€ë‹ˆì–´</p>

<blockquote>
<p>ë³´ìŠ¤~ ì›í•˜ì‹œëŠ” ì†”ë£¨ì…˜ì…ë‹ˆë‹¤.</p>

<p>userId, movieId ê°’ì„ ì…ë ¥í•˜ì‹œë©´<br />
ì˜ˆìƒë˜ëŠ” ë³„ì ê°’ì´ ì¶œë ¥ ë©ë‹ˆë‹¤.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">userId <span style="color:#f92672">=</span> <span style="color:#ae81ff">214</span>       <span style="color:#75715e"># 1 ~ 610</span>
movieId <span style="color:#f92672">=</span> <span style="color:#ae81ff">1059</span>  <span style="color:#75715e"># 1 ~ 193609</span>
movie_title <span style="color:#f92672">=</span> list(movies_df[movies_df[<span style="color:#e6db74">&#39;movieId&#39;</span>]<span style="color:#f92672">==</span>movieId]<span style="color:#f92672">.</span>title)[<span style="color:#ae81ff">0</span>]

user_v <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>expand_dims(userid2idx[userId], <span style="color:#ae81ff">0</span>)
movie_v <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>expand_dims(movieid2idx[movieId], <span style="color:#ae81ff">0</span>)
predict <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict([user_v, movie_v])

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;ì˜í™” {} ì— ëŒ€í•œ ì‚¬ìš©ì ID {}ë‹˜ì˜ ì˜ˆìƒ ë³„ì ì€ {:.1f} ì…ë‹ˆë‹¤.&#39;</span><span style="color:#f92672">.</span>format(movie_title, userId, predict[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]))</code></pre></div>
<pre><code>ì˜í™” William Shakespeare's Romeo + Juliet (1996) ì— ëŒ€í•œ ì‚¬ìš©ì ID 214ë‹˜ì˜ ì˜ˆìƒ ë³„ì ì€ 3.8 ì…ë‹ˆë‹¤.
</code></pre>
		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/latent-factor/" rel="tag">Latent factor</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/matrix-factorization/" rel="tag">Matrix Factorization</a></li>
		<li class="tags__item"><a class="tags__link btn" href="/tags/embedding/" rel="tag">Embedding</a></li>
	</ul>
</div>
		</footer>
	</article>
</main>


<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/post/convolutional_neural_network/" rel="prev"><span class="post-nav__caption">Â«&thinsp;Previous</span><p class="post-nav__post-title">Convolutional Neural Network</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/post/recurrent_neural_network/" rel="next"><span class="post-nav__caption">Next&thinsp;Â»</span><p class="post-nav__post-title">Recurrent Neural Network</p></a>
	</div>
</nav>
<script src="https://utteranc.es/client.js"
        repo="skettee/blog-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 skettee.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>